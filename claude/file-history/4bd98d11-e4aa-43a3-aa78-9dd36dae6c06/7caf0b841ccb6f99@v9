import { Inject, Injectable } from '@nestjs/common';
import { v7 } from 'uuid';
import { SaveShipment } from '../../../data/dao/types/saveShipment';
import { ShipmentInput } from '../../../data/model/shipment';

@Injectable()
export class ShipmentCreator {
  constructor(
    @Inject('uuid') private readonly uuid: typeof v7
  ) { }

  public execute(
    organizationId: string,
    shipments: ShipmentInput[]
  ): SaveShipment[] {
    return shipments.map((shipment) => this.createShipment(organizationId, shipment));
  }

  private createShipment(
    organizationId: string,
    shipment: ShipmentInput
  ): SaveShipment {
    return {
      id: this.uuid(),
      organizationId,
      slipId: shipment.slipId,
      consignor: shipment.consignor,
      consignee: shipment.consignee,
      originSpotId: shipment.originSpotId,
      destinationSpotId: shipment.destinationSpotId,
      meta: shipment.meta,
    };
  }
}
