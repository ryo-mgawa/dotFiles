import { ShipmentInsert } from '@app/rdb/db/model';
import { Inject, Injectable } from '@nestjs/common';
import { v7 } from 'uuid';
import { ShipmentInput } from '../../data/model/shipment';

@Injectable()
export class ShipmentCreator {
  constructor(
    @Inject('uuid') private readonly uuid: typeof v7
  ) { }

  public execute(
    organizationId: string,
    shipments: ShipmentInput[]
  ): ShipmentInsert[] {
    return shipments.map((shipment) => this.createShipment(organizationId, shipment));
  }

  private createShipment(
    organizationId: string,
    shipment: ShipmentInput
  ): ShipmentInsert {
    return {
      id: this.uuid(),
      organization_id: organizationId,
      slip_id: shipment.slipId,
      consignor: JSON.stringify(shipment.consignor),
      consignee: JSON.stringify(shipment.consignee),
      origin_spot_id: shipment.originSpotId,
      destination_spot_id: shipment.destinationSpotId,
      meta: shipment.meta ? JSON.stringify(shipment.meta) : null,
    };
  }
}
