import { useNavigate, useLocation } from 'react-router-dom';
import { Button } from '@/shared/components';
import './SessionEndedPage.scss';

interface LocationState {
  reason?: 'operating_hours_ended' | 'manual' | 'error';
}

type MessageInfo = { title: string; description: string };

const DEFAULT_MESSAGE: MessageInfo = {
  title: 'セッション終了',
  description: 'ビデオ通話セッションが終了しました。',
};

const MESSAGES: Record<string, MessageInfo> = {
  operating_hours_ended: {
    title: '稼働時間が終了しました',
    description: '本日の稼働時間が終了したため、セッションを終了しました。',
  },
  manual: {
    title: 'セッションを終了しました',
    description: 'ビデオ通話セッションを終了しました。',
  },
  error: {
    title: 'エラーが発生しました',
    description: '予期しないエラーが発生したため、セッションを終了しました。',
  },
  default: DEFAULT_MESSAGE,
};

export const SessionEndedPage = () => {
  const navigate = useNavigate();
  const location = useLocation();
  const state = location.state as LocationState | null;
  const reason = state?.reason || 'default';
  const message = MESSAGES[reason] ?? DEFAULT_MESSAGE;

  const handleBackToLogin = () => {
    navigate('/login', { replace: true });
  };

  return (
    <div className="session-ended-page">
      <div className="session-ended-page__container">
        <div className="session-ended-page__icon">
          <svg
            width="64"
            height="64"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <circle cx="12" cy="12" r="10" />
            <line x1="12" y1="8" x2="12" y2="12" />
            <line x1="12" y1="16" x2="12.01" y2="16" />
          </svg>
        </div>
        <h1 className="session-ended-page__title">{message.title}</h1>
        <p className="session-ended-page__description">{message.description}</p>
        <Button onClick={handleBackToLogin}>ログイン画面へ戻る</Button>
      </div>
    </div>
  );
};
