import { Inject, Injectable } from '@nestjs/common';
import { Response } from 'express';
import { Shipment } from '../../../data/model/shipment';
import { GetShipmentsPresenterInterface } from '../../../interface/presenter/getShipmentsPresenterInterface';
import { Output, ShipmentItem } from '../dto/getShipments/output';

@Injectable()
export class GetShipmentsPresenter implements GetShipmentsPresenterInterface {
  constructor(@Inject('RESPONSE') private readonly response: Response) {}

  public output(shipments: Shipment[]): void {
    const result: Output = {
      status: 'success',
      shipments: this.convertShipments(shipments),
    };

    this.response.status(200).send(result);
  }

  private convertShipments(shipments: Shipment[]): ShipmentItem[] {
    return shipments.map((shipment) => ({
      id: shipment.id,
      slipId: shipment.slipId,
      consignor: shipment.consignor,
      consignee: shipment.consignee,
      originSpot: {
        id: shipment.originSpotId,
      },
      destinationSpot: {
        id: shipment.destinationSpotId,
      },
      meta: shipment.meta,
    }));
  }
}
