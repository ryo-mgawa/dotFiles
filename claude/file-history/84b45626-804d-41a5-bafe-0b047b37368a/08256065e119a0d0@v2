import {
  ValidatorConstraint,
  ValidatorConstraintInterface,
} from 'class-validator';

const MAX_META_SIZE_BYTES = 1024; // 1kb

@ValidatorConstraint({ name: 'metaSize', async: false })
export class MetaSizeValidator implements ValidatorConstraintInterface {
  public validate(meta: any): boolean {
    if (!meta) return true;
    const size = JSON.stringify(meta).length;
    return size < MAX_META_SIZE_BYTES;
  }

  public defaultMessage(): string {
    return 'metaのデータ量は1kb未満にする必要があります';
  }
}
