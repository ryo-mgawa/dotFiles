import { useEffect, useState } from 'react';
import { Container, Row, Col, Card } from 'react-bootstrap';
import { ActivitySchedule } from '@/components/home/ActivitySchedule';
import { LoadingSpinner } from '@/components/common/LoadingSpinner';
import { ErrorMessage } from '@/components/common/ErrorMessage';
import { getActivities } from '@/services/api/activitiesApi';
import { Activity } from '@/types/models/Activity';

/**
 * トップページ
 * requirements.md 2.1節を参照
 */
export const HomePage = () => {
  const [activities, setActivities] = useState<Activity[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const fetchData = async () => {
      try {
        const data = await getActivities();
        setActivities(data);
      } catch (err) {
        setError('活動情報の取得に失敗しました');
        console.error(err);
      } finally {
        setLoading(false);
      }
    };

    void fetchData();
  }, []);

  if (loading) return <LoadingSpinner />;
  if (error) return <ErrorMessage message={error} />;

  return (
    <Container>
      <Row className="mb-4">
        <Col>
          <h1>豊田高専陸上部</h1>
          <p>豊田工業高等専門学校陸上競技部の公式ホームページへようこそ</p>
        </Col>
      </Row>

      <Row className="mb-4">
        <Col md={6}>
          <Card>
            <Card.Header>
              <h4>活動時間</h4>
            </Card.Header>
            <Card.Body>
              <ActivitySchedule activities={activities} />
            </Card.Body>
          </Card>
        </Col>
        <Col md={6}>
          <Card>
            <Card.Header>
              <h4>最新情報</h4>
            </Card.Header>
            <Card.Body>
              <p>Twitter埋め込み予定</p>
            </Card.Body>
          </Card>
        </Col>
      </Row>
    </Container>
  );
};
