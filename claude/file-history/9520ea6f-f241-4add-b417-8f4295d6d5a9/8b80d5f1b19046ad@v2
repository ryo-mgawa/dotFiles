import { ICompetitionRepository } from '../../../domain/repositories/ICompetitionRepository';
import { CompetitionDto } from '../../dto/CompetitionDto';
import { Competition } from '../../../shared/types';

/**
 * 年度別大会一覧取得ユースケース
 * requirements.md 2.4節を参照
 */
export class GetCompetitionsByYearUseCase {
  constructor(private readonly competitionRepository: ICompetitionRepository) {}

  async execute(year?: number): Promise<CompetitionDto[]> {
    const competitions = year
      ? await this.competitionRepository.findByYear(year)
      : await this.competitionRepository.findAll();

    return competitions.map((competition) => this.toDto(competition));
  }

  private toDto(competition: Competition): CompetitionDto {
    return {
      id: competition.id,
      name: competition.name,
      location: competition.location,
      date: competition.date.toISOString(),
      year: competition.year,
    };
  }
}
