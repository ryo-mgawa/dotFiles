import dotenv from 'dotenv';

// .envファイルを読み込み
dotenv.config();

/**
 * 環境変数の型定義と読み込み
 */
export const env = {
  // サーバー設定
  port: parseInt(process.env.PORT || '3000', 10),
  nodeEnv: process.env.NODE_ENV || 'development',

  // データソース設定
  useMock: process.env.USE_MOCK === 'true',

  // データベース設定（Phase 4で使用）
  databaseUrl: process.env.DATABASE_URL || '',

  // CORS設定
  frontendUrl: process.env.FRONTEND_URL || 'http://localhost:5173',

  // microCMS設定（将来的に使用）
  microCmsServiceDomain: process.env.MICROCMS_SERVICE_DOMAIN || '',
  microCmsApiKey: process.env.MICROCMS_API_KEY || '',
} as const;

/**
 * 必須環境変数のバリデーション
 */
export function validateEnv(): void {
  if (!env.useMock && !env.databaseUrl) {
    throw new Error(
      'DATABASE_URL is required when USE_MOCK=false. Please check your .env file.'
    );
  }

  console.log('[ENV] Environment variables loaded');
  console.log(`[ENV] NODE_ENV: ${env.nodeEnv}`);
  console.log(`[ENV] PORT: ${env.port}`);
  console.log(`[ENV] USE_MOCK: ${env.useMock}`);
}
