import { ConfigService } from '@nestjs/config';
import { getFirestore, Firestore } from 'firebase-admin/firestore';
import { FIREBASE_APP_NAME } from '../../firebaseAppName';
import { createFirebaseAdminApp } from '../createFirebaseAdminApp';
import { AutomationFirestoreProviderIdentity } from './providerIdentity';

const AUTOMATION_DATABASE_NAME = 'automation';

export const AutomationFirestoreFactory = {
  provide: AutomationFirestoreProviderIdentity,
  useFactory(configService: ConfigService): Firestore {
    const app = createFirebaseAdminApp({
      appName: FIREBASE_APP_NAME.FIREBASE_ADMIN_CLIENT_APP,
      initializeOptions: {
        serviceAccountId: configService.get('FIREBASE_TOKEN_ADMIN_SERVICE_ACCOUNT'),
      },
    });
    return getFirestore(app, AUTOMATION_DATABASE_NAME);
  },
  inject: [ConfigService],
};
