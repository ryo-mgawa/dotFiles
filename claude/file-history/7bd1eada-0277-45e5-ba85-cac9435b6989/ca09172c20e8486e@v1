# 拠点間ビデオ通話Webアプリケーション 要件定義書

## 1. 概要
Zoom Video SDK (v2.3.5) を使用した拠点間ビデオ通話Webアプリケーション

## 2. 機能要件

### 2.1 認証・セキュリティ
- **拠点トークン認証（デバイス自動認証）**
  - 各拠点に固有のアクセストークン（UUID）を発行
  - 拠点専用URL（`/site/{accessToken}`）にアクセスすることで自動認証
  - 認証成功後、自動的にビデオ通話画面へ遷移（ノータッチ運用）
  - Zoom SDK JWTも同時に発行し、即座にセッション参加可能
- **デバイス登録制限**
  - 各拠点につき1台のデバイスのみ登録可能
  - 初回アクセス時にデバイスIDを自動生成・登録
  - 登録済みデバイス以外からのアクセスは拒否
  - 管理者がデバイスを削除することで、新しいデバイスの登録が可能
  - デバイスIDはブラウザのローカルストレージに保存
- **ユーザーログイン認証**
  - 管理者・設定変更用のメールアドレス/パスワード認証
  - JWT認証トークンを発行
- **マルチテナント対応**
  - 複数会社の利用を想定
  - 他社の通話セッションへのアクセスを完全に制限
  - 会社単位でのセッション分離
- **SDK認証情報管理**
  - Zoom Video SDK の認証情報（SDK KEY、SDK SECRET）は環境変数で管理
  - ソースコードへの認証情報のハードコーディング禁止
  - 環境変数ファイル（.env）はバージョン管理対象外

### 2.2 ディスプレイ・UI要件
- **4Kディスプレイ対応**
  - 縦向き画面（時計回りに90度回転）を前提としたUI設計
  - F11キーによるフルスクリーン運用（URLバー等の非表示）
- **UI要素（最小限）**
  - マイクミュート切り替えボタン
  - ビデオオン/オフ切り替えボタン

### 2.3 画面レイアウト

#### 2.3.1 通常モード（3拠点以上接続時）
- **メイン表示エリア（上部80%）**
  - 選択された1拠点をフルサイズで表示
  - デフォルトは特定拠点（例：東京）を表示
- **サブ表示エリア（下部20%）**
  - メイン以外の拠点を表示
  - 横並びで複数拠点を配置
- **セルフビュー（右下）**
  - 自分の映像を右下に小さく表示
  - 他の拠点に自分がどう映っているかを確認可能

#### 2.3.2 シンプルモード（2拠点のみ接続時）
- サブエリアは非表示
- 相手拠点を画面全体（100%）に表示
- **セルフビュー（右下）**
  - 自分の映像を右下に小さく表示

### 2.4 音量制御
- **メイン表示拠点**: 音量大
- **サブ表示拠点**: 音量小
- メイン/サブ切り替え時に自動で音量調整

### 2.5 操作機能
- **キーボードショートカット**
  - メイン表示拠点の切り替えをキーボードで実施
  - 拠点切り替え時、前のメイン拠点は自動的にサブエリアへ移動

### 2.6 映像品質
- **初期仕様**: フルHD（1920x1080）画質での通話
- 今後の拡張で4K対応を検討

### 2.7 拠点例
- 東京、名古屋、大阪、福岡など複数拠点を想定
- 現在地が名古屋の場合の初期表示例：
  - メイン: 東京
  - サブ: 大阪、福岡

### 2.8 稼働時間管理
- **会社単位での稼働時間設定**
  - 事前ヒアリングにより、会社ごとに稼働開始時間・終了時間を設定
  - 曜日ごとに異なる稼働時間を設定可能
  - 祝日・休業日の設定が可能
- **稼働時間外の制御**
  - 稼働時間外はセッションへの参加を拒否（APIエラーを返却）
  - 稼働時間中に参加していた場合、終了時刻到達時に自動退出
  - 終了時刻の一定時間前（例：5分前）に警告通知を表示
- **セッション離脱**
  - セッションからの離脱API提供（自動退出処理で使用）
  - 参加履歴の記録（参加日時・離脱日時）
- **管理機能**
  - 管理者による稼働スケジュールの登録・変更
  - 臨時の稼働時間変更に対応
  - 例外日（祝日・休業日・臨時稼働）の追加・削除

## 3. 非機能要件

### 3.1 品質要件
- **可用性**: 営業時間帯での安定稼働
- **セキュリティ**:
  - JWT認証による厳格なアクセス制御
  - 会社間データの完全分離
  - HTTPS通信の必須化
- **スケーラビリティ**: 将来的な拠点数増加への対応

## 4. 制約事項
- Zoom Video SDK Web 2.3.5 の仕様・制限に準拠
- 縦向き4Kディスプレイ環境での動作を最優先
