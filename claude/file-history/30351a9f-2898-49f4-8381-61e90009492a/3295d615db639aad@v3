# æ‹ ç‚¹é–“ãƒ“ãƒ‡ã‚ªé€šè©±Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ è¨­è¨ˆæ›¸

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### 1.1 ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              React SPA (front/)                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ Presentationâ”‚  â”‚ Application â”‚  â”‚    Domain       â”‚  â”‚   â”‚
â”‚  â”‚  â”‚    Layer    â”‚â”€â”€â”‚    Layer    â”‚â”€â”€â”‚    Layer        â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTPS/WebSocket
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ã‚µãƒ¼ãƒãƒ¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Node.js/Express (server/)                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ Presentationâ”‚  â”‚ Application â”‚  â”‚ Infrastructure  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  (Routes)   â”‚â”€â”€â”‚  (UseCases) â”‚â”€â”€â”‚ (Repository)    â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Supabase      â”‚    â”‚   Zoom Video     â”‚
â”‚   (PostgreSQL)   â”‚    â”‚      SDK         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ |
|---------|------|-----------|
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | React | 18.x (æœ€æ–°å®‰å®šç‰ˆ) |
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | TypeScript | 5.x (æœ€æ–°å®‰å®šç‰ˆ) |
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | Vite | 5.x (æœ€æ–°å®‰å®šç‰ˆ) |
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | React Router | 6.x (æœ€æ–°å®‰å®šç‰ˆ) |
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | Node.js | 20.x LTS |
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | Express | 4.x (æœ€æ–°å®‰å®šç‰ˆ) |
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | TypeScript | 5.x (æœ€æ–°å®‰å®šç‰ˆ) |
| ORM | Prisma | 5.x (æœ€æ–°å®‰å®šç‰ˆ) |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | Supabase (PostgreSQL) | - |
| ãƒ“ãƒ‡ã‚ªé€šè©± | Zoom Video SDK | 2.3.5 |
| ãƒ†ã‚¹ãƒˆ | Vitest | 1.x (æœ€æ–°å®‰å®šç‰ˆ) |
| ãƒ†ã‚¹ãƒˆ | Testing Library | 14.x (æœ€æ–°å®‰å®šç‰ˆ) |

---

## 2. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

### 2.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (front/)

```
front/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ presentation/          # ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤
â”‚   â”‚   â”œâ”€â”€ components/        # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ common/        # å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Button/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Icon/
â”‚   â”‚   â”‚   â”œâ”€â”€ video/         # ãƒ“ãƒ‡ã‚ªé–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MainVideoDisplay/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SubVideoDisplay/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ VideoControls/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ VideoGrid/
â”‚   â”‚   â”‚   â””â”€â”€ layout/        # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚       â”œâ”€â”€ VerticalLayout/
â”‚   â”‚   â”‚       â””â”€â”€ FullScreenLayout/
â”‚   â”‚   â”œâ”€â”€ pages/             # ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ LoginPage/
â”‚   â”‚   â”‚   â””â”€â”€ VideoCallPage/
â”‚   â”‚   â””â”€â”€ hooks/             # ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”‚       â”œâ”€â”€ useKeyboardShortcut.ts
â”‚   â”‚       â””â”€â”€ useFullScreen.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ application/           # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤
â”‚   â”‚   â”œâ”€â”€ usecases/          # ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ LoginUseCase.ts
â”‚   â”‚   â”‚   â””â”€â”€ video/
â”‚   â”‚   â”‚       â”œâ”€â”€ JoinSessionUseCase.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ SwitchMainSiteUseCase.ts
â”‚   â”‚   â”‚       â””â”€â”€ ControlMediaUseCase.ts
â”‚   â”‚   â”œâ”€â”€ services/          # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ ZoomVideoService.ts
â”‚   â”‚   â”‚   â””â”€â”€ OperatingHoursService.ts
â”‚   â”‚   â””â”€â”€ state/             # çŠ¶æ…‹ç®¡ç†
â”‚   â”‚       â”œâ”€â”€ context/
â”‚   â”‚       â”‚   â”œâ”€â”€ AuthContext.tsx
â”‚   â”‚       â”‚   â””â”€â”€ VideoContext.tsx
â”‚   â”‚       â””â”€â”€ reducers/
â”‚   â”‚           â”œâ”€â”€ authReducer.ts
â”‚   â”‚           â””â”€â”€ videoReducer.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ domain/                # ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤
â”‚   â”‚   â”œâ”€â”€ entities/          # ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚   â”‚   â”‚   â”œâ”€â”€ User.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ Company.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ Site.ts
â”‚   â”‚   â”‚   â””â”€â”€ VideoSession.ts
â”‚   â”‚   â”œâ”€â”€ valueObjects/      # å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ SiteId.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ CompanyId.ts
â”‚   â”‚   â”‚   â””â”€â”€ VolumeLevel.ts
â”‚   â”‚   â””â”€â”€ repositories/      # ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚   â”‚       â”œâ”€â”€ IAuthRepository.ts
â”‚   â”‚       â””â”€â”€ ISiteRepository.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/        # ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤
â”‚   â”‚   â”œâ”€â”€ api/               # APIé€šä¿¡
â”‚   â”‚   â”‚   â”œâ”€â”€ apiClient.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ authApi.ts
â”‚   â”‚   â”‚   â””â”€â”€ siteApi.ts
â”‚   â”‚   â”œâ”€â”€ repositories/      # ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthRepository.ts
â”‚   â”‚   â”‚   â””â”€â”€ SiteRepository.ts
â”‚   â”‚   â””â”€â”€ zoom/              # Zoom SDKé–¢é€£
â”‚   â”‚       â”œâ”€â”€ ZoomClient.ts
â”‚   â”‚       â””â”€â”€ ZoomMediaStream.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                # è¨­å®š
â”‚   â”‚   â””â”€â”€ constants.ts
â”‚   â”‚
â”‚   â””â”€â”€ types/                 # å‹å®šç¾©
â”‚       â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ tests/                     # ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ e2e/
â”‚
â”œâ”€â”€ public/
â”œâ”€â”€ index.html
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tsconfig.json
â””â”€â”€ package.json
```

### 2.2 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (server/)

```
server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ presentation/          # ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤
â”‚   â”‚   â”œâ”€â”€ routes/            # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
â”‚   â”‚   â”‚   â”œâ”€â”€ authRoutes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ siteRoutes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ sessionRoutes.ts
â”‚   â”‚   â”‚   â””â”€â”€ scheduleRoutes.ts
â”‚   â”‚   â”œâ”€â”€ controllers/       # ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthController.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ SiteController.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ SessionController.ts
â”‚   â”‚   â”‚   â””â”€â”€ ScheduleController.ts
â”‚   â”‚   â”œâ”€â”€ middleware/        # ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”‚   â”‚   â”‚   â”œâ”€â”€ authMiddleware.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ errorMiddleware.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ operatingHoursMiddleware.ts
â”‚   â”‚   â”‚   â””â”€â”€ validationMiddleware.ts
â”‚   â”‚   â””â”€â”€ validators/        # ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼
â”‚   â”‚       â”œâ”€â”€ authValidator.ts
â”‚   â”‚       â””â”€â”€ sessionValidator.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ application/           # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤
â”‚   â”‚   â”œâ”€â”€ usecases/          # ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LoginUseCase.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ GenerateJwtUseCase.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ site/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ GetSitesUseCase.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ session/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CreateSessionUseCase.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ JoinSessionUseCase.ts
â”‚   â”‚   â”‚   â””â”€â”€ schedule/
â”‚   â”‚   â”‚       â”œâ”€â”€ CheckOperatingHoursUseCase.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ GetScheduleUseCase.ts
â”‚   â”‚   â”‚       â””â”€â”€ UpdateScheduleUseCase.ts
â”‚   â”‚   â”œâ”€â”€ services/          # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”‚   â””â”€â”€ OperatingHoursService.ts
â”‚   â”‚   â””â”€â”€ dto/               # ãƒ‡ãƒ¼ã‚¿è»¢é€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
â”‚   â”‚       â”œâ”€â”€ AuthDto.ts
â”‚   â”‚       â”œâ”€â”€ SiteDto.ts
â”‚   â”‚       â”œâ”€â”€ SessionDto.ts
â”‚   â”‚       â””â”€â”€ ScheduleDto.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ domain/                # ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤
â”‚   â”‚   â”œâ”€â”€ entities/          # ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚   â”‚   â”‚   â”œâ”€â”€ User.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ Company.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ Site.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ Session.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ OperatingSchedule.ts
â”‚   â”‚   â”‚   â””â”€â”€ OperatingScheduleException.ts
â”‚   â”‚   â”œâ”€â”€ valueObjects/      # å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ UserId.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ CompanyId.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ SessionTopic.ts
â”‚   â”‚   â”‚   â””â”€â”€ TimeRange.ts
â”‚   â”‚   â”œâ”€â”€ repositories/      # ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ IUserRepository.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ ICompanyRepository.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ ISiteRepository.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ ISessionRepository.ts
â”‚   â”‚   â”‚   â””â”€â”€ IScheduleRepository.ts
â”‚   â”‚   â””â”€â”€ errors/            # ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼
â”‚   â”‚       â”œâ”€â”€ AuthError.ts
â”‚   â”‚       â”œâ”€â”€ SessionError.ts
â”‚   â”‚       â””â”€â”€ OperatingHoursError.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/        # ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤
â”‚   â”‚   â”œâ”€â”€ database/          # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
â”‚   â”‚   â”‚   â””â”€â”€ prisma/
â”‚   â”‚   â”‚       â”œâ”€â”€ client.ts
â”‚   â”‚   â”‚       â””â”€â”€ schema.prisma
â”‚   â”‚   â”œâ”€â”€ repositories/      # ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…
â”‚   â”‚   â”‚   â”œâ”€â”€ UserRepository.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ CompanyRepository.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ SiteRepository.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ SessionRepository.ts
â”‚   â”‚   â”‚   â””â”€â”€ ScheduleRepository.ts
â”‚   â”‚   â””â”€â”€ services/          # å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚       â”œâ”€â”€ ZoomJwtService.ts
â”‚   â”‚       â””â”€â”€ SessionKickService.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                # è¨­å®š
â”‚   â”‚   â”œâ”€â”€ env.ts
â”‚   â”‚   â””â”€â”€ constants.ts
â”‚   â”‚
â”‚   â””â”€â”€ app.ts                 # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ãƒˆãƒª
â”‚
â”œâ”€â”€ tests/                     # ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ unit/
â”‚   â””â”€â”€ integration/
â”‚
â”œâ”€â”€ tsconfig.json
â””â”€â”€ package.json
```

---

## 3. ç”»é¢è¨­è¨ˆ

### 3.1 ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆç¸¦ç”»é¢ãƒ»90åº¦å›è»¢ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                        â”‚  â†‘
â”‚                                        â”‚  â”‚
â”‚                                        â”‚  â”‚
â”‚          ãƒ¡ã‚¤ãƒ³è¡¨ç¤ºã‚¨ãƒªã‚¢               â”‚  â”‚
â”‚           (ä¸Šéƒ¨ 80%)                   â”‚  â”‚  ç”»é¢é«˜ã•
â”‚                                        â”‚  â”‚  (4K: 3840px)
â”‚         é¸æŠã•ã‚ŒãŸæ‹ ç‚¹ã®æ˜ åƒ            â”‚  â”‚
â”‚                                        â”‚  â”‚
â”‚                                        â”‚  â”‚
â”‚                                        â”‚  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ æ‹ ç‚¹A  â”‚  â”‚ æ‹ ç‚¹B  â”‚  â”‚ æ‹ ç‚¹C  â”‚   â”‚  â”‚  ã‚µãƒ–è¡¨ç¤º
â”‚  â”‚        â”‚  â”‚        â”‚  â”‚        â”‚   â”‚  â”‚  (ä¸‹éƒ¨ 20%)
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â†“
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ¤]  [ğŸ“¹]                            â”‚  ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â† ç”»é¢å¹… (4K: 2160px) â†’
```

### 3.2 2æ‹ ç‚¹æ¥ç¶šæ™‚ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                        â”‚
â”‚                                        â”‚
â”‚                                        â”‚
â”‚                                        â”‚
â”‚          ç›¸æ‰‹æ‹ ç‚¹ã®æ˜ åƒ                 â”‚
â”‚           (100% ãƒ•ãƒ«è¡¨ç¤º)              â”‚
â”‚                                        â”‚
â”‚                                        â”‚
â”‚                                        â”‚
â”‚                                        â”‚
â”‚                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ¤]  [ğŸ“¹]                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆéšå±¤

```
VideoCallPage
â”œâ”€â”€ VerticalLayout
â”‚   â”œâ”€â”€ MainVideoDisplay
â”‚   â”‚   â””â”€â”€ VideoCanvas (ãƒ¡ã‚¤ãƒ³æ‹ ç‚¹æ˜ åƒ)
â”‚   â”œâ”€â”€ SubVideoDisplay (3æ‹ ç‚¹ä»¥ä¸Šæ™‚ã®ã¿è¡¨ç¤º)
â”‚   â”‚   â””â”€â”€ VideoGrid
â”‚   â”‚       â””â”€â”€ VideoThumbnail[] (ã‚µãƒ–æ‹ ç‚¹æ˜ åƒ)
â”‚   â””â”€â”€ VideoControls
â”‚       â”œâ”€â”€ MicrophoneButton
â”‚       â””â”€â”€ CameraButton
â””â”€â”€ KeyboardShortcutHandler
```

---

## 4. çŠ¶æ…‹ç®¡ç†è¨­è¨ˆ

### 4.1 AuthContext

```typescript
interface AuthState {
  isAuthenticated: boolean;
  user: User | null;
  company: Company | null;
  token: string | null;
  loading: boolean;
  error: string | null;
}

type AuthAction =
  | { type: 'LOGIN_START' }
  | { type: 'LOGIN_SUCCESS'; payload: { user: User; company: Company; token: string } }
  | { type: 'LOGIN_FAILURE'; payload: string }
  | { type: 'LOGOUT' };
```

### 4.2 VideoContext

```typescript
interface VideoState {
  sessionStatus: 'idle' | 'connecting' | 'connected' | 'disconnected';
  participants: Participant[];
  mainSiteId: string | null;
  localMedia: {
    isMicOn: boolean;
    isCameraOn: boolean;
  };
  volumeSettings: Record<string, number>;  // siteId -> volume (0-100)
  error: string | null;
}

type VideoAction =
  | { type: 'CONNECT_START' }
  | { type: 'CONNECT_SUCCESS'; payload: Participant[] }
  | { type: 'CONNECT_FAILURE'; payload: string }
  | { type: 'PARTICIPANT_JOIN'; payload: Participant }
  | { type: 'PARTICIPANT_LEAVE'; payload: string }
  | { type: 'SWITCH_MAIN_SITE'; payload: string }
  | { type: 'TOGGLE_MIC' }
  | { type: 'TOGGLE_CAMERA' }
  | { type: 'DISCONNECT' };
```

---

## 5. APIè¨­è¨ˆ

### 5.1 èªè¨¼API

#### POST /api/auth/login
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³

**Request:**
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "uuid",
      "name": "å±±ç”°å¤ªéƒ",
      "email": "user@example.com",
      "siteId": "site-nagoya"
    },
    "company": {
      "id": "company-uuid",
      "name": "æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«"
    },
    "accessToken": "eyJhbGciOiJIUzI1NiIs..."
  }
}
```

### 5.2 ã‚»ãƒƒã‚·ãƒ§ãƒ³API

#### POST /api/sessions/join
ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«å‚åŠ ï¼ˆZoom JWTå–å¾—ï¼‰

**Request:**
```json
{
  "siteId": "site-nagoya"
}
```

**Response (æˆåŠŸæ™‚):**
```json
{
  "success": true,
  "data": {
    "zoomJwt": "eyJhbGciOiJIUzI1NiIs...",
    "sessionTopic": "company-uuid-session",
    "userName": "åå¤å±‹",
    "sites": [
      { "id": "site-tokyo", "name": "æ±äº¬", "isOnline": true },
      { "id": "site-osaka", "name": "å¤§é˜ª", "isOnline": true },
      { "id": "site-fukuoka", "name": "ç¦å²¡", "isOnline": false }
    ],
    "operatingHours": {
      "endTime": "18:00",
      "remainingMinutes": 120,
      "warningThresholdMinutes": 5
    }
  }
}
```

**Response (ç¨¼åƒæ™‚é–“å¤–ã‚¨ãƒ©ãƒ¼):**
```json
{
  "success": false,
  "error": {
    "code": "OUTSIDE_OPERATING_HOURS",
    "message": "ç¾åœ¨ã¯ç¨¼åƒæ™‚é–“å¤–ã§ã™",
    "details": {
      "currentTime": "19:30",
      "operatingHours": {
        "startTime": "09:00",
        "endTime": "18:00"
      },
      "nextOperatingDay": "2025-01-06",
      "nextStartTime": "09:00"
    }
  }
}
```

### 5.3 æ‹ ç‚¹API

#### GET /api/sites
ä¼šç¤¾ã®æ‹ ç‚¹ä¸€è¦§å–å¾—

**Response:**
```json
{
  "success": true,
  "data": {
    "sites": [
      { "id": "site-tokyo", "name": "æ±äº¬", "displayOrder": 1 },
      { "id": "site-nagoya", "name": "åå¤å±‹", "displayOrder": 2 },
      { "id": "site-osaka", "name": "å¤§é˜ª", "displayOrder": 3 },
      { "id": "site-fukuoka", "name": "ç¦å²¡", "displayOrder": 4 }
    ]
  }
}
```

### 5.4 ç¨¼åƒæ™‚é–“ç®¡ç†API

#### GET /api/schedules
ç¨¼åƒã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€è¦§å–å¾—

**Response:**
```json
{
  "success": true,
  "data": {
    "schedules": [
      { "dayOfWeek": 0, "startTime": null, "endTime": null, "isEnabled": false },
      { "dayOfWeek": 1, "startTime": "09:00", "endTime": "18:00", "isEnabled": true },
      { "dayOfWeek": 2, "startTime": "09:00", "endTime": "18:00", "isEnabled": true },
      { "dayOfWeek": 3, "startTime": "09:00", "endTime": "18:00", "isEnabled": true },
      { "dayOfWeek": 4, "startTime": "09:00", "endTime": "18:00", "isEnabled": true },
      { "dayOfWeek": 5, "startTime": "09:00", "endTime": "18:00", "isEnabled": true },
      { "dayOfWeek": 6, "startTime": null, "endTime": null, "isEnabled": false }
    ],
    "exceptions": [
      { "date": "2025-01-01", "type": "holiday", "description": "å…ƒæ—¥" },
      { "date": "2025-03-15", "type": "custom", "startTime": "10:00", "endTime": "15:00", "description": "è‡¨æ™‚ç¨¼åƒ" }
    ],
    "timezone": "Asia/Tokyo"
  }
}
```

#### PUT /api/schedules
ç¨¼åƒã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ›´æ–°ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰

**Request:**
```json
{
  "schedules": [
    { "dayOfWeek": 1, "startTime": "08:30", "endTime": "17:30", "isEnabled": true }
  ]
}
```

#### POST /api/schedules/exceptions
ä¾‹å¤–æ—¥ã®è¿½åŠ ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰

**Request:**
```json
{
  "date": "2025-12-29",
  "type": "closed",
  "description": "å¹´æœ«ä¼‘æ¥­"
}
```

#### GET /api/schedules/status
ç¾åœ¨ã®ç¨¼åƒçŠ¶æ…‹ã‚’å–å¾—

**Response:**
```json
{
  "success": true,
  "data": {
    "isOperating": true,
    "currentTime": "14:30",
    "todaySchedule": {
      "startTime": "09:00",
      "endTime": "18:00"
    },
    "remainingMinutes": 210,
    "warningThresholdMinutes": 5
  }
}
```

---

## 6. ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆè¨­è¨ˆ

| ã‚­ãƒ¼ | æ©Ÿèƒ½ |
|------|------|
| `1` | 1ç•ªç›®ã®æ‹ ç‚¹ã‚’ãƒ¡ã‚¤ãƒ³ã«è¡¨ç¤º |
| `2` | 2ç•ªç›®ã®æ‹ ç‚¹ã‚’ãƒ¡ã‚¤ãƒ³ã«è¡¨ç¤º |
| `3` | 3ç•ªç›®ã®æ‹ ç‚¹ã‚’ãƒ¡ã‚¤ãƒ³ã«è¡¨ç¤º |
| `4` | 4ç•ªç›®ã®æ‹ ç‚¹ã‚’ãƒ¡ã‚¤ãƒ³ã«è¡¨ç¤º |
| `M` | ãƒã‚¤ã‚¯ã®ãƒŸãƒ¥ãƒ¼ãƒˆåˆ‡ã‚Šæ›¿ãˆ |
| `V` | ã‚«ãƒ¡ãƒ©ã®ã‚ªãƒ³/ã‚ªãƒ•åˆ‡ã‚Šæ›¿ãˆ |
| `â†` / `â†’` | ãƒ¡ã‚¤ãƒ³è¡¨ç¤ºã®å‰å¾Œåˆ‡ã‚Šæ›¿ãˆ |

---

## 7. éŸ³é‡åˆ¶å¾¡è¨­è¨ˆ

### 7.1 éŸ³é‡ãƒ¬ãƒ™ãƒ«å®šæ•°

```typescript
// config/constants.ts
export const VOLUME_LEVELS = {
  MAIN: 100,      // ãƒ¡ã‚¤ãƒ³æ‹ ç‚¹: æœ€å¤§éŸ³é‡
  SUB: 30,        // ã‚µãƒ–æ‹ ç‚¹: 30%éŸ³é‡
  MUTED: 0        // ãƒŸãƒ¥ãƒ¼ãƒˆ
} as const;
```

### 7.2 éŸ³é‡åˆ‡ã‚Šæ›¿ãˆãƒ­ã‚¸ãƒƒã‚¯

```typescript
// ãƒ¡ã‚¤ãƒ³æ‹ ç‚¹åˆ‡ã‚Šæ›¿ãˆæ™‚ã®éŸ³é‡èª¿æ•´
const switchMainSite = (newMainSiteId: string) => {
  // å‰ã®ãƒ¡ã‚¤ãƒ³æ‹ ç‚¹ã‚’ä½éŸ³é‡ã«
  if (currentMainSiteId) {
    zoomMediaStream.adjustUserVolume(currentMainSiteId, VOLUME_LEVELS.SUB);
  }

  // æ–°ã—ã„ãƒ¡ã‚¤ãƒ³æ‹ ç‚¹ã‚’é«˜éŸ³é‡ã«
  zoomMediaStream.adjustUserVolume(newMainSiteId, VOLUME_LEVELS.MAIN);

  setMainSiteId(newMainSiteId);
};
```

---

## 8. ç¨¼åƒæ™‚é–“ç®¡ç†è¨­è¨ˆ

### 8.1 ç¨¼åƒæ™‚é–“ãƒã‚§ãƒƒã‚¯ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ã‚»ãƒƒã‚·ãƒ§ãƒ³å‚åŠ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              operatingHoursMiddleware.ts                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. ä¼šç¤¾IDã‹ã‚‰ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å–å¾—                             â”‚   â”‚
â”‚  â”‚ 2. ç¾åœ¨æ—¥æ™‚ã‚’ä¼šç¤¾ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã§å–å¾—                        â”‚   â”‚
â”‚  â”‚ 3. ä¾‹å¤–æ—¥ï¼ˆç¥æ—¥ãƒ»è‡¨æ™‚ä¼‘æ¥­ï¼‰ãƒã‚§ãƒƒã‚¯                        â”‚   â”‚
â”‚  â”‚ 4. é€šå¸¸ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯                               â”‚   â”‚
â”‚  â”‚ 5. ç¨¼åƒæ™‚é–“å†… â†’ next() / æ™‚é–“å¤– â†’ ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼                                     â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   ç¨¼åƒæ™‚é–“å†…   â”‚                    â”‚  ç¨¼åƒæ™‚é–“å¤–   â”‚
   â”‚  ã‚»ãƒƒã‚·ãƒ§ãƒ³å‚åŠ â”‚                    â”‚  ã‚¨ãƒ©ãƒ¼è¿”å´   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 ç¨¼åƒæ™‚é–“åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯

```typescript
// application/services/OperatingHoursService.ts

interface OperatingStatus {
  isOperating: boolean;
  currentTime: string;
  todaySchedule: { startTime: string; endTime: string } | null;
  remainingMinutes: number | null;
  reason?: 'holiday' | 'closed' | 'outside_hours' | 'day_off';
}

class OperatingHoursService {
  async checkOperatingStatus(companyId: string): Promise<OperatingStatus> {
    const company = await this.companyRepository.findById(companyId);
    const now = this.getCurrentTimeInTimezone(company.timezone);
    const today = now.toISODate();
    const dayOfWeek = now.weekday % 7; // 0-6 (æ—¥æ›œ=0)

    // 1. ä¾‹å¤–æ—¥ãƒã‚§ãƒƒã‚¯ï¼ˆç¥æ—¥ãƒ»è‡¨æ™‚ä¼‘æ¥­ãƒ»è‡¨æ™‚ç¨¼åƒï¼‰
    const exception = await this.scheduleRepository.findException(companyId, today);
    if (exception) {
      return this.handleException(exception, now);
    }

    // 2. é€šå¸¸ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯
    const schedule = await this.scheduleRepository.findByDayOfWeek(companyId, dayOfWeek);
    if (!schedule?.isEnabled) {
      return { isOperating: false, reason: 'day_off', ... };
    }

    // 3. æ™‚é–“ç¯„å›²ãƒã‚§ãƒƒã‚¯
    return this.checkTimeRange(schedule, now);
  }
}
```

### 8.3 è‡ªå‹•é€€å‡ºï¼ˆã‚­ãƒƒã‚¯ï¼‰æ©Ÿèƒ½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              OperatingHoursMonitor                       â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ æ®‹ã‚Šæ™‚é–“ã‚«ã‚¦ãƒ³ãƒˆ   â”‚ â”€â”€â–¶ â”‚ 5åˆ†å‰: è­¦å‘Šé€šçŸ¥è¡¨ç¤º       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ (1åˆ†é–“éš”ã§APIç¢ºèª) â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚   â”‚
â”‚  â”‚           â”‚                                              â”‚   â”‚
â”‚  â”‚           â–¼                                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ æ®‹ã‚Š0åˆ†åˆ°é”       â”‚ â”€â”€â–¶ â”‚ è‡ªå‹•é€€å‡ºå‡¦ç†å®Ÿè¡Œ          â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ ãƒ»Zoomã‚»ãƒƒã‚·ãƒ§ãƒ³é›¢è„±      â”‚ â”‚   â”‚
â”‚  â”‚                            â”‚ ãƒ»çµ‚äº†ç”»é¢ã¸é·ç§»          â”‚ â”‚   â”‚
â”‚  â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.4 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

```typescript
// presentation/hooks/useOperatingHoursMonitor.ts

const POLLING_INTERVAL_MS = 60000;  // 1åˆ†é–“éš”
const WARNING_THRESHOLD_MINUTES = 5;

export const useOperatingHoursMonitor = () => {
  const [remainingMinutes, setRemainingMinutes] = useState<number | null>(null);
  const [showWarning, setShowWarning] = useState(false);
  const { disconnect } = useVideoContext();

  useEffect(() => {
    const checkStatus = async () => {
      const status = await operatingHoursApi.getStatus();

      if (!status.isOperating) {
        // ç¨¼åƒæ™‚é–“å¤–ã«ãªã£ãŸ â†’ å¼·åˆ¶é€€å‡º
        await disconnect();
        navigate('/session-ended', { reason: 'operating_hours_ended' });
        return;
      }

      setRemainingMinutes(status.remainingMinutes);

      // è­¦å‘Šè¡¨ç¤º
      if (status.remainingMinutes <= WARNING_THRESHOLD_MINUTES) {
        setShowWarning(true);
      }
    };

    const interval = setInterval(checkStatus, POLLING_INTERVAL_MS);
    checkStatus(); // åˆå›å³æ™‚å®Ÿè¡Œ

    return () => clearInterval(interval);
  }, []);

  return { remainingMinutes, showWarning };
};
```

### 8.5 è­¦å‘Šé€šçŸ¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```typescript
// presentation/components/OperatingHoursWarning.tsx

const OperatingHoursWarning: React.FC<{ remainingMinutes: number }> = ({
  remainingMinutes
}) => {
  if (remainingMinutes > WARNING_THRESHOLD_MINUTES) {
    return null;
  }

  return (
    <div className="operating-hours-warning">
      <span>ç¨¼åƒçµ‚äº†ã¾ã§æ®‹ã‚Š {remainingMinutes} åˆ†ã§ã™</span>
      <span>çµ‚äº†æ™‚åˆ»ã«ãªã‚‹ã¨è‡ªå‹•çš„ã«é€šè©±ãŒçµ‚äº†ã—ã¾ã™</span>
    </div>
  );
};
```

### 8.6 å®šæ•°å®šç¾©

```typescript
// config/constants.ts

export const OPERATING_HOURS = {
  POLLING_INTERVAL_MS: 60000,         // çŠ¶æ…‹ç¢ºèªé–“éš”ï¼ˆ1åˆ†ï¼‰
  WARNING_THRESHOLD_MINUTES: 5,        // è­¦å‘Šè¡¨ç¤ºã®é–¾å€¤ï¼ˆçµ‚äº†5åˆ†å‰ï¼‰
  GRACE_PERIOD_SECONDS: 30,           // çµ‚äº†å¾Œã®çŒ¶äºˆæ™‚é–“ï¼ˆ30ç§’ï¼‰
} as const;

export const DAY_OF_WEEK = {
  SUNDAY: 0,
  MONDAY: 1,
  TUESDAY: 2,
  WEDNESDAY: 3,
  THURSDAY: 4,
  FRIDAY: 5,
  SATURDAY: 6,
} as const;
```

---

## 9. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### 9.1 ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢

```
ã‚»ãƒƒã‚·ãƒ§ãƒ³topicå‘½åè¦å‰‡: {companyId}-video-session

ä¾‹:
- ä¼šç¤¾A: company-a-uuid-video-session
- ä¼šç¤¾B: company-b-uuid-video-session

â†’ ç•°ãªã‚‹ä¼šç¤¾ã¯ç•°ãªã‚‹topicã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€ç›¸äº’ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯
```

### 9.2 JWTèªè¨¼ãƒ•ãƒ­ãƒ¼

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼: ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±é€ä¿¡
   â†“
2. ã‚µãƒ¼ãƒãƒ¼: ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ â†’ ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œ
   â†“
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã‚»ãƒƒã‚·ãƒ§ãƒ³å‚åŠ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ä»˜ã)
   â†“
4. ã‚µãƒ¼ãƒãƒ¼: ä¼šç¤¾IDæ¤œè¨¼ â†’ Zoom SDK JWTç”Ÿæˆ
   â†“
5. ãƒ¦ãƒ¼ã‚¶ãƒ¼: Zoom SDK JWT ã§ãƒ“ãƒ‡ã‚ªã‚»ãƒƒã‚·ãƒ§ãƒ³æ¥ç¶š
```

### 9.3 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

| å¯¾ç­– | å®Ÿè£… |
|------|------|
| HTTPSå¼·åˆ¶ | Helmet middleware |
| CORSåˆ¶é™ | è¨±å¯ã‚ªãƒªã‚¸ãƒ³ã®ã¿ |
| JWTæœ‰åŠ¹æœŸé™ | 2æ™‚é–“ï¼ˆZoom SDK JWTï¼‰ |
| ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | express-rate-limit |
| å…¥åŠ›æ¤œè¨¼ | Zod / class-validator |

---

## 10. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¨­è¨ˆ

### 10.1 ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ã‚¯ãƒ©ã‚¹

```typescript
// domain/errors/AppError.ts
abstract class AppError extends Error {
  abstract readonly statusCode: number;
  abstract readonly isOperational: boolean;
}

class AuthenticationError extends AppError {
  readonly statusCode = 401;
  readonly isOperational = true;
}

class AuthorizationError extends AppError {
  readonly statusCode = 403;
  readonly isOperational = true;
}

class NotFoundError extends AppError {
  readonly statusCode = 404;
  readonly isOperational = true;
}

class VideoConnectionError extends AppError {
  readonly statusCode = 500;
  readonly isOperational = true;
}
```

### 10.2 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```typescript
// Zoom SDKæ¥ç¶šã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥
const MAX_RETRY_COUNT = 3;
const RETRY_DELAY_MS = 2000;

const connectWithRetry = async (retryCount = 0): Promise<void> => {
  try {
    await zoomClient.join(topic, token, userName);
  } catch (error) {
    if (retryCount < MAX_RETRY_COUNT) {
      await delay(RETRY_DELAY_MS);
      return connectWithRetry(retryCount + 1);
    }
    throw new VideoConnectionError('æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸ');
  }
};
```

---

## 11. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### 11.1 ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰

```
        /\
       /  \       E2E ãƒ†ã‚¹ãƒˆ (å°‘æ•°)
      /    \      - ä¸»è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼
     /â”€â”€â”€â”€â”€â”€\
    /        \    çµ±åˆãƒ†ã‚¹ãƒˆ (ä¸­ç¨‹åº¦)
   /          \   - API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
  /â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\  - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé€£æº
 /              \
/                \ ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ (å¤šæ•°)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  - ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
                    - ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
                    - ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
```

### 11.2 TDDã‚µã‚¤ã‚¯ãƒ«

```
1. Red: å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
   â†“
2. Green: ãƒ†ã‚¹ãƒˆãŒé€šã‚‹æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
   â†“
3. Refactor: ã‚³ãƒ¼ãƒ‰ã‚’æ”¹å–„ï¼ˆãƒ†ã‚¹ãƒˆã¯é€šã£ãŸã¾ã¾ï¼‰
   â†“
1. ã«æˆ»ã‚‹
```

### 11.3 ãƒ†ã‚¹ãƒˆå¯¾è±¡

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | ãƒ†ã‚¹ãƒˆå¯¾è±¡ | ãƒ„ãƒ¼ãƒ« |
|---------|-----------|--------|
| Domain | ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã€å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ | Vitest |
| Application | ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ | Vitest + Mock |
| Presentation | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | Testing Library |
| Infrastructure | ãƒªãƒã‚¸ãƒˆãƒª | Vitest + Prisma Mock |
| E2E | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼ | Playwright |

---

## 12. ä»Šå¾Œã®æ‹¡å¼µæ€§

### 12.1 æ©Ÿèƒ½æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ

| æ©Ÿèƒ½ | æ‹¡å¼µæ–¹æ³• |
|------|---------|
| 4Kå¯¾å¿œ | VideoQuality.Video_4K ä½¿ç”¨ |
| æ‹ ç‚¹è¿½åŠ  | DBç™»éŒ²ã®ã¿ã§å¯¾å¿œå¯èƒ½ |
| éŒ²ç”»æ©Ÿèƒ½ | Zoom SDK RecordingClient ä½¿ç”¨ |
| ç”»é¢å…±æœ‰ | Zoom SDK Shareæ©Ÿèƒ½ ä½¿ç”¨ |
| ãƒãƒ£ãƒƒãƒˆ | Zoom SDK ChatClient ä½¿ç”¨ |

### 12.2 ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°

- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: CDNé…ä¿¡
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°å¯¾å¿œï¼ˆã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹è¨­è¨ˆï¼‰
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: Supabaseã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°æ©Ÿèƒ½æ´»ç”¨
