# 拠点間ビデオ通話Webアプリケーション 要件定義書

## 1. 概要
Zoom Video SDK (v2.3.5) を使用した拠点間ビデオ通話Webアプリケーション

## 2. 機能要件

### 2.1 認証・セキュリティ
- **JWT認証**
  - アプリケーションアクセス時にJWT認証を実施
  - 認証成功後に通話へ参加可能
- **マルチテナント対応**
  - 複数会社の利用を想定
  - 他社の通話セッションへのアクセスを完全に制限
  - 会社単位でのセッション分離

### 2.2 ディスプレイ・UI要件
- **4Kディスプレイ対応**
  - 縦向き画面（時計回りに90度回転）を前提としたUI設計
  - F11キーによるフルスクリーン運用（URLバー等の非表示）
- **UI要素（最小限）**
  - マイクミュート切り替えボタン
  - ビデオオン/オフ切り替えボタン

### 2.3 画面レイアウト

#### 2.3.1 通常モード（3拠点以上接続時）
- **メイン表示エリア（上部80%）**
  - 選択された1拠点をフルサイズで表示
  - デフォルトは特定拠点（例：東京）を表示
- **サブ表示エリア（下部20%）**
  - メイン以外の拠点を表示
  - 横並びで複数拠点を配置

#### 2.3.2 シンプルモード（2拠点のみ接続時）
- サブエリアは非表示
- 相手拠点を画面全体（100%）に表示

### 2.4 音量制御
- **メイン表示拠点**: 音量大
- **サブ表示拠点**: 音量小
- メイン/サブ切り替え時に自動で音量調整

### 2.5 操作機能
- **キーボードショートカット**
  - メイン表示拠点の切り替えをキーボードで実施
  - 拠点切り替え時、前のメイン拠点は自動的にサブエリアへ移動

### 2.6 映像品質
- **初期仕様**: フルHD（1920x1080）画質での通話
- 今後の拡張で4K対応を検討

### 2.7 拠点例
- 東京、名古屋、大阪、福岡など複数拠点を想定
- 現在地が名古屋の場合の初期表示例：
  - メイン: 東京
  - サブ: 大阪、福岡

## 3. 非機能要件

### 3.1 アーキテクチャ要件
- **Clean Architecture** の採用
  - レイヤー分離（Presentation / Application / Domain / Infrastructure）
  - 依存性の逆転原則に基づく設計
- **TDD（テスト駆動開発）** の実践
  - t-wada氏のアプローチに準拠
  - ユニットテスト・統合テストの実装

### 3.2 コーディング規約

#### 3.2.1 制御構造
- **アーリーリターンの積極活用**
  - ネストを深くしない
  - 条件分岐では早期リターンを使用
  - ガード句の活用

#### 3.2.2 定数管理
- **マジックナンバー・ハードコーディングの禁止**
  - 数値は定数として定義
  - 文字列リテラルは定数として管理
  - 設定値は環境変数または設定ファイルで管理

#### 3.2.3 型安全性
- **TypeScriptのany型の使用禁止**
  - 適切な型定義の必須化
  - unknown型の適切な活用
  - 厳格な型チェックの実施

#### 3.2.4 関数・メソッド設計
- **単一責任の原則（SRP）** の徹底
- 純粋関数の活用（副作用の最小化）
- 関数は20行以内を目安とする
- 引数は3つ以内を推奨

#### 3.2.5 エラーハンドリング
- 例外は適切にキャッチし、適切なエラーメッセージを提供
- try-catch文の適切な使用
- カスタム例外クラスの活用

#### 3.2.6 パフォーマンス
- 不要な再レンダリングの防止（React.memo、useMemo活用）
- メモリリークの防止
- ビデオストリームの効率的な管理

#### 3.2.7 可読性・保守性
- 自己文書化コードの作成
- 意図が伝わる変数名・関数名の使用
- 複雑なロジックには適切なコメント
- デッドコードの除去

### 3.3 技術スタック

#### 3.3.1 フロントエンド
- **React 18+ (最新安定版) + TypeScript**
- **Zoom Video SDK Web 2.3.5**
- CSS/UIフレームワーク（要検討）
- React Router（SPA対応）
- 状態管理: Context API + useReducer または Redux Toolkit
- ディレクトリ: `front`

#### 3.3.2 バックエンド
- **Node.js/Express (最新LTS版) + TypeScript**
- Clean Architecture 適用
- JWT認証実装
- CORS・Helmet によるセキュリティ対応
- ディレクトリ: `server`

#### 3.3.3 データベース
- **Supabase（PostgreSQL）**
- 会社・ユーザー・セッション管理
- 適切なインデックス設計
- トランザクション管理

### 3.4 品質要件
- **可用性**: 営業時間帯での安定稼働
- **セキュリティ**:
  - JWT認証による厳格なアクセス制御
  - 会社間データの完全分離
  - HTTPS通信の必須化
- **スケーラビリティ**: 将来的な拠点数増加への対応
- **保守性**: Clean Architectureによる変更容易性の確保

## 4. 制約事項
- Zoom Video SDK Web 2.3.5 の仕様・制限に準拠
- 縦向き4Kディスプレイ環境での動作を最優先
- フルスクリーンモード（F11）での運用が前提

## 5. 今後の拡張可能性
- 4K画質対応
- 拠点数の増加
- レコーディング機能
- 画面共有機能
- チャット機能
