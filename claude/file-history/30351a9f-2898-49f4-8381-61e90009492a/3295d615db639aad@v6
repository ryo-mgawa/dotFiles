# æ‹ ç‚¹é–“ãƒ“ãƒ‡ã‚ªé€šè©±Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ è¨­è¨ˆæ›¸

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### 1.1 ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              React SPA (front/)                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ Presentationâ”‚  â”‚ Application â”‚  â”‚    Domain       â”‚  â”‚   â”‚
â”‚  â”‚  â”‚    Layer    â”‚â”€â”€â”‚    Layer    â”‚â”€â”€â”‚    Layer        â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTPS/WebSocket
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ã‚µãƒ¼ãƒãƒ¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Node.js/Express (server/)                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ Presentationâ”‚  â”‚ Application â”‚  â”‚ Infrastructure  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  (Routes)   â”‚â”€â”€â”‚  (UseCases) â”‚â”€â”€â”‚ (Repository)    â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Supabase      â”‚    â”‚   Zoom Video     â”‚
â”‚   (PostgreSQL)   â”‚    â”‚      SDK         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ |
|---------|------|-----------|
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | React | 18.x (æœ€æ–°å®‰å®šç‰ˆ) |
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | TypeScript | 5.x (æœ€æ–°å®‰å®šç‰ˆ) |
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | Vite | 5.x (æœ€æ–°å®‰å®šç‰ˆ) |
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | React Router | 6.x (æœ€æ–°å®‰å®šç‰ˆ) |
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | Node.js | 20.x LTS |
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | Express | 4.x (æœ€æ–°å®‰å®šç‰ˆ) |
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | TypeScript | 5.x (æœ€æ–°å®‰å®šç‰ˆ) |
| ORM | Prisma | 5.x (æœ€æ–°å®‰å®šç‰ˆ) |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | Supabase (PostgreSQL) | - |
| ãƒ“ãƒ‡ã‚ªé€šè©± | Zoom Video SDK | 2.3.5 |
| ãƒ†ã‚¹ãƒˆ | Vitest | 1.x (æœ€æ–°å®‰å®šç‰ˆ) |
| ãƒ†ã‚¹ãƒˆ | Testing Library | 14.x (æœ€æ–°å®‰å®šç‰ˆ) |

### 1.3 ç’°å¢ƒå¤‰æ•°è¨­è¨ˆ

#### 1.3.1 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ç’°å¢ƒå¤‰æ•°

```bash
# server/.env

# Database
DATABASE_URL="postgresql://user:password@host:5432/dbname"

# JWT (ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èªè¨¼ç”¨)
JWT_SECRET="your-jwt-secret-key"
JWT_EXPIRES_IN="24h"

# Zoom Video SDK (é‹å–¶å´ã§1ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†)
ZOOM_SDK_KEY="your-zoom-sdk-key"
ZOOM_SDK_SECRET="your-zoom-sdk-secret"
ZOOM_JWT_EXPIRES_IN="7200"  # ç§’ï¼ˆ2æ™‚é–“ï¼‰

# Server
PORT="3001"
NODE_ENV="development"
CORS_ORIGIN="http://localhost:5173"

# Operating Hours
WARNING_THRESHOLD_MINUTES="5"
```

#### 1.3.2 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç’°å¢ƒå¤‰æ•°

```bash
# front/.env

VITE_API_BASE_URL="http://localhost:3001/api"
VITE_ZOOM_WEB_ENDPOINT="zoom.us"
```

#### 1.3.3 ç’°å¢ƒå¤‰æ•°ã®ç®¡ç†æ–¹é‡

| é …ç›® | æ–¹é‡ |
|------|------|
| æœ¬ç•ªç’°å¢ƒ | ç’°å¢ƒå¤‰æ•°ã¯å¤–éƒ¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹ã§ç®¡ç† |
| é–‹ç™ºç’°å¢ƒ | `.env.local` ã‚’ä½¿ç”¨ï¼ˆGitç®¡ç†å¯¾è±¡å¤–ï¼‰ |
| ã‚µãƒ³ãƒ—ãƒ« | `.env.example` ã‚’ãƒªãƒã‚¸ãƒˆãƒªã«å«ã‚ã‚‹ |
| SDKèªè¨¼æƒ…å ± | `ZOOM_SDK_KEY` / `ZOOM_SDK_SECRET` ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã¿ã§ä½¿ç”¨ |
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | SDK Secretã¯çµ¶å¯¾ã«å…¬é–‹ã—ãªã„ï¼ˆJWTã®ã¿ä½¿ç”¨ï¼‰ |

#### 1.3.4 Zoom SDKèªè¨¼ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç’°å¢ƒå¤‰æ•°                                                        â”‚
â”‚  ZOOM_SDK_KEY, ZOOM_SDK_SECRET                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã‚µãƒ¼ãƒãƒ¼ (ZoomJwtService.ts)                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. SDK Key/Secret ã‚’ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã¿                    â”‚   â”‚
â”‚  â”‚ 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³å‚åŠ æ™‚ã«Zoom SDK JWTç”Ÿæˆ                       â”‚   â”‚
â”‚  â”‚    - topic: {companyId}-video-session (ä¼šç¤¾åˆ†é›¢)           â”‚   â”‚
â”‚  â”‚    - role: 1 (host) ã¾ãŸã¯ 0 (participant)                 â”‚   â”‚
â”‚  â”‚    - æœ‰åŠ¹æœŸé™: 2æ™‚é–“                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ JWT ãƒˆãƒ¼ã‚¯ãƒ³
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (ZoomClient.ts)                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰Zoom SDK JWTã‚’å—ã‘å–ã‚‹                       â”‚   â”‚
â”‚  â”‚ 2. ZoomClient.init() ã§åˆæœŸåŒ–                              â”‚   â”‚
â”‚  â”‚ 3. ZoomClient.join(topic, jwt, userName) ã§æ¥ç¶š            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **Note**: Zoom SDK Key/Secretã¯é‹å–¶å´ã§1ã¤ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ã—ã¦ç®¡ç†ã—ã€ä¼šç¤¾ã”ã¨ã«ç•°ãªã‚‹topicã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

### 1.4 ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³

æœ¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ä»¥ä¸‹ã®ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¡ç”¨ã—ã€ä¿å®ˆæ€§ãƒ»æ‹¡å¼µæ€§ãƒ»ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚

#### 1.4.1 Observer Patternï¼ˆå‚åŠ è€…çŠ¶æ…‹ãƒ»ç¨¼åƒæ™‚é–“ç›£è¦–ï¼‰

å‚åŠ è€…ã®å…¥é€€å®¤ã‚„ç¨¼åƒæ™‚é–“ã®å¤‰åŒ–ã‚’ã€é–¢å¿ƒã®ã‚ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«é€šçŸ¥ã—ã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Subject (Observable)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              VideoSessionSubject                         â”‚   â”‚
â”‚  â”‚  - observers: Set<VideoSessionObserver>                  â”‚   â”‚
â”‚  â”‚  - participants: Participant[]                           â”‚   â”‚
â”‚  â”‚  + subscribe(observer): void                             â”‚   â”‚
â”‚  â”‚  + unsubscribe(observer): void                           â”‚   â”‚
â”‚  â”‚  + notify(event): void                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ notify
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Observers (Subscribers)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ VideoGrid     â”‚  â”‚ VolumeManager â”‚  â”‚ ParticipantCount  â”‚   â”‚
â”‚  â”‚ Observer      â”‚  â”‚ Observer      â”‚  â”‚ Observer          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®Ÿè£…:**

```typescript
// domain/observers/VideoSessionObserver.ts

interface VideoSessionEvent {
  type: 'PARTICIPANT_JOIN' | 'PARTICIPANT_LEAVE' | 'PARTICIPANT_UPDATE';
  participant: Participant;
  timestamp: Date;
}

interface VideoSessionObserver {
  onSessionEvent(event: VideoSessionEvent): void;
}

// application/subjects/VideoSessionSubject.ts

class VideoSessionSubject {
  private observers: Set<VideoSessionObserver> = new Set();

  subscribe(observer: VideoSessionObserver): () => void {
    this.observers.add(observer);
    return () => this.unsubscribe(observer);
  }

  unsubscribe(observer: VideoSessionObserver): void {
    this.observers.delete(observer);
  }

  notify(event: VideoSessionEvent): void {
    this.observers.forEach(observer => observer.onSessionEvent(event));
  }
}
```

**ç¨¼åƒæ™‚é–“ç›£è¦–ã¸ã®é©ç”¨:**

```typescript
// domain/observers/OperatingHoursObserver.ts

interface OperatingHoursEvent {
  type: 'WARNING' | 'EXPIRED' | 'STATUS_CHANGE';
  remainingMinutes: number;
  message: string;
}

interface OperatingHoursObserver {
  onOperatingHoursEvent(event: OperatingHoursEvent): void;
}

// ä½¿ç”¨ä¾‹: è¤‡æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒç¨¼åƒæ™‚é–“ã®å¤‰åŒ–ã‚’è³¼èª­
class WarningNotificationObserver implements OperatingHoursObserver {
  onOperatingHoursEvent(event: OperatingHoursEvent): void {
    if (event.type === 'WARNING') {
      showNotification(event.message);
    }
  }
}

class AutoDisconnectObserver implements OperatingHoursObserver {
  constructor(private disconnectFn: () => Promise<void>) {}

  onOperatingHoursEvent(event: OperatingHoursEvent): void {
    if (event.type === 'EXPIRED') {
      this.disconnectFn();
    }
  }
}
```

---

#### 1.4.2 Facade Patternï¼ˆZoom SDKæ“ä½œã®ç°¡ç•¥åŒ–ï¼‰

è¤‡é›‘ãªZoom SDKã®APIã‚’ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§éš è”½ã—ã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Client Code                               â”‚
â”‚                   (VideoCallPage, UseCases)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ ç°¡æ½”ãªAPIå‘¼ã³å‡ºã—
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ZoomVideoFacade                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  + joinSession(config: SessionConfig): Promise<void>     â”‚   â”‚
â”‚  â”‚  + leaveSession(): Promise<void>                         â”‚   â”‚
â”‚  â”‚  + toggleMicrophone(): Promise<boolean>                  â”‚   â”‚
â”‚  â”‚  + toggleCamera(): Promise<boolean>                      â”‚   â”‚
â”‚  â”‚  + setParticipantVolume(id, level): Promise<void>        â”‚   â”‚
â”‚  â”‚  + switchMainDisplay(siteId): void                       â”‚   â”‚
â”‚  â”‚  + getParticipants(): Participant[]                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ å†…éƒ¨ã§è¤‡é›‘ãªæ“ä½œã‚’å®Ÿè¡Œ
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Zoom SDK Subsystems                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ZoomVideo    â”‚  â”‚ MediaStream  â”‚  â”‚ Participant          â”‚  â”‚
â”‚  â”‚ Client       â”‚  â”‚              â”‚  â”‚ Manager              â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ init()       â”‚  â”‚ startAudio() â”‚  â”‚ getAllUser()         â”‚  â”‚
â”‚  â”‚ join()       â”‚  â”‚ startVideo() â”‚  â”‚ getUser()            â”‚  â”‚
â”‚  â”‚ leave()      â”‚  â”‚ stopAudio()  â”‚  â”‚ adjustUserVolume()   â”‚  â”‚
â”‚  â”‚ on()         â”‚  â”‚ stopVideo()  â”‚  â”‚ renderVideo()        â”‚  â”‚
â”‚  â”‚ off()        â”‚  â”‚ muteAudio()  â”‚  â”‚ stopRenderVideo()    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®Ÿè£…:**

```typescript
// infrastructure/zoom/ZoomVideoFacade.ts

interface SessionConfig {
  topic: string;
  token: string;
  userName: string;
  videoQuality?: VideoQuality;
}

class ZoomVideoFacade {
  private client: typeof ZoomVideo;
  private mediaStream: MediaStream | null = null;
  private sessionSubject: VideoSessionSubject;

  constructor(sessionSubject: VideoSessionSubject) {
    this.client = ZoomVideo.createClient();
    this.sessionSubject = sessionSubject;
  }

  async joinSession(config: SessionConfig): Promise<void> {
    await this.client.init('en-US', 'Global', { patchJsMedia: true });
    await this.client.join(config.topic, config.token, config.userName);
    this.mediaStream = this.client.getMediaStream();
    this.setupEventListeners();
  }

  async leaveSession(): Promise<void> {
    await this.client.leave();
    this.mediaStream = null;
  }

  async toggleMicrophone(): Promise<boolean> {
    if (!this.mediaStream) throw new Error('Not connected');

    const isCurrentlyMuted = this.mediaStream.isAudioMuted();
    if (isCurrentlyMuted) {
      await this.mediaStream.unmuteAudio();
    } else {
      await this.mediaStream.muteAudio();
    }
    return !isCurrentlyMuted;
  }

  async toggleCamera(): Promise<boolean> {
    if (!this.mediaStream) throw new Error('Not connected');

    const isCapturing = this.mediaStream.isCapturingVideo();
    if (isCapturing) {
      await this.mediaStream.stopVideo();
    } else {
      await this.mediaStream.startVideo({ videoQuality: VideoQuality.Video_1080P });
    }
    return !isCapturing;
  }

  async setParticipantVolume(participantId: string, volume: number): Promise<void> {
    if (!this.mediaStream) throw new Error('Not connected');
    await this.mediaStream.adjustUserAudioVolumeLocally(participantId, volume);
  }

  private setupEventListeners(): void {
    this.client.on('user-added', (participants) => {
      participants.forEach(p => {
        this.sessionSubject.notify({
          type: 'PARTICIPANT_JOIN',
          participant: this.mapToParticipant(p),
          timestamp: new Date()
        });
      });
    });

    this.client.on('user-removed', (participants) => {
      participants.forEach(p => {
        this.sessionSubject.notify({
          type: 'PARTICIPANT_LEAVE',
          participant: this.mapToParticipant(p),
          timestamp: new Date()
        });
      });
    });
  }

  private mapToParticipant(sdkUser: ZoomParticipant): Participant {
    return {
      id: String(sdkUser.oderId),
      name: sdkUser.displayName,
      isVideoOn: sdkUser.bVideoOn,
      isAudioOn: !sdkUser.muted
    };
  }
}
```

---

#### 1.4.3 Adapter Patternï¼ˆSDKä¾å­˜ã®åˆ†é›¢ï¼‰

Zoom SDKã¸ã®ä¾å­˜ã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã‹ã‚‰åˆ†é›¢ã—ã€ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£ã¨å°†æ¥ã®SDKå¤‰æ›´ã¸ã®è€æ€§ã‚’ç¢ºä¿ã—ã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Application Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   JoinSessionUseCase                     â”‚   â”‚
â”‚  â”‚  - videoService: IVideoService  â† ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ä¾å­˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ ä¾å­˜æ€§ã®é€†è»¢
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Domain Layer (Interface)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    IVideoService                         â”‚   â”‚
â”‚  â”‚  + connect(config): Promise<void>                        â”‚   â”‚
â”‚  â”‚  + disconnect(): Promise<void>                           â”‚   â”‚
â”‚  â”‚  + toggleAudio(): Promise<boolean>                       â”‚   â”‚
â”‚  â”‚  + toggleVideo(): Promise<boolean>                       â”‚   â”‚
â”‚  â”‚  + setVolume(participantId, level): Promise<void>        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚ å®Ÿè£…
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ZoomVideoAdapter    â”‚               â”‚ MockVideoAdapter    â”‚
â”‚ (æœ¬ç•ªç”¨)             â”‚               â”‚ (ãƒ†ã‚¹ãƒˆç”¨)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - facade: Zoom      â”‚               â”‚ - state: MockState  â”‚
â”‚   VideoFacade       â”‚               â”‚                     â”‚
â”‚                     â”‚               â”‚                     â”‚
â”‚ + connect()         â”‚               â”‚ + connect()         â”‚
â”‚ + disconnect()      â”‚               â”‚ + disconnect()      â”‚
â”‚ + toggleAudio()     â”‚               â”‚ + toggleAudio()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®Ÿè£…:**

```typescript
// domain/services/IVideoService.ts

interface VideoConnectionConfig {
  sessionTopic: string;
  token: string;
  userName: string;
}

interface IVideoService {
  connect(config: VideoConnectionConfig): Promise<void>;
  disconnect(): Promise<void>;
  toggleAudio(): Promise<boolean>;
  toggleVideo(): Promise<boolean>;
  setVolume(participantId: string, level: VolumeLevel): Promise<void>;
  getParticipants(): Participant[];
  subscribeToEvents(observer: VideoSessionObserver): () => void;
}

// infrastructure/adapters/ZoomVideoAdapter.ts

class ZoomVideoAdapter implements IVideoService {
  private facade: ZoomVideoFacade;

  constructor(sessionSubject: VideoSessionSubject) {
    this.facade = new ZoomVideoFacade(sessionSubject);
  }

  async connect(config: VideoConnectionConfig): Promise<void> {
    await this.facade.joinSession({
      topic: config.sessionTopic,
      token: config.token,
      userName: config.userName,
      videoQuality: VideoQuality.Video_1080P
    });
  }

  async disconnect(): Promise<void> {
    await this.facade.leaveSession();
  }

  async toggleAudio(): Promise<boolean> {
    return this.facade.toggleMicrophone();
  }

  async toggleVideo(): Promise<boolean> {
    return this.facade.toggleCamera();
  }

  async setVolume(participantId: string, level: VolumeLevel): Promise<void> {
    await this.facade.setParticipantVolume(participantId, level.value);
  }

  getParticipants(): Participant[] {
    return this.facade.getParticipants();
  }

  subscribeToEvents(observer: VideoSessionObserver): () => void {
    return this.facade.subscribe(observer);
  }
}

// infrastructure/adapters/MockVideoAdapter.ts (ãƒ†ã‚¹ãƒˆç”¨)

class MockVideoAdapter implements IVideoService {
  private connected = false;
  private audioOn = false;
  private videoOn = false;
  private participants: Participant[] = [];

  async connect(_config: VideoConnectionConfig): Promise<void> {
    this.connected = true;
  }

  async disconnect(): Promise<void> {
    this.connected = false;
  }

  async toggleAudio(): Promise<boolean> {
    this.audioOn = !this.audioOn;
    return this.audioOn;
  }

  async toggleVideo(): Promise<boolean> {
    this.videoOn = !this.videoOn;
    return this.videoOn;
  }

  async setVolume(_participantId: string, _level: VolumeLevel): Promise<void> {
    // Mock implementation
  }

  getParticipants(): Participant[] {
    return this.participants;
  }

  // ãƒ†ã‚¹ãƒˆç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼
  simulateParticipantJoin(participant: Participant): void {
    this.participants.push(participant);
  }

  subscribeToEvents(_observer: VideoSessionObserver): () => void {
    return () => {};
  }
}
```

---

#### 1.4.4 State Patternï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç†ï¼‰

ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹é·ç§»ã‚’æ˜ç¢ºã«å®šç¾©ã—ã€å„çŠ¶æ…‹ã§ã®æŒ¯ã‚‹èˆã„ã‚’ã‚«ãƒ—ã‚»ãƒ«åŒ–ã—ã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      State Diagram                               â”‚
â”‚                                                                  â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    connect()    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚     â”‚  Idle   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ Connecting â”‚                  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚          â–²                            â”‚                          â”‚
â”‚          â”‚                            â”‚ success                  â”‚
â”‚          â”‚ disconnect()               â–¼                          â”‚
â”‚     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚     â”‚Disconnectedâ”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ Connected  â”‚                   â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  disconnect() â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚          â–²                            â”‚                          â”‚
â”‚          â”‚              error         â”‚ error                    â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®Ÿè£…:**

```typescript
// domain/states/SessionState.ts

interface SessionContext {
  videoService: IVideoService;
  config: VideoConnectionConfig;
  onStateChange: (state: SessionState) => void;
  onError: (error: Error) => void;
}

abstract class SessionState {
  constructor(protected context: SessionContext) {}

  abstract get status(): SessionStatus;

  // å„çŠ¶æ…‹ã§è¨±å¯ã•ã‚Œã‚‹æ“ä½œï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ä½•ã‚‚ã—ãªã„ï¼‰
  async connect(): Promise<void> {
    console.warn(`Cannot connect in ${this.status} state`);
  }

  async disconnect(): Promise<void> {
    console.warn(`Cannot disconnect in ${this.status} state`);
  }

  async toggleAudio(): Promise<boolean> {
    console.warn(`Cannot toggle audio in ${this.status} state`);
    return false;
  }

  async toggleVideo(): Promise<boolean> {
    console.warn(`Cannot toggle video in ${this.status} state`);
    return false;
  }

  protected transitionTo(state: SessionState): void {
    this.context.onStateChange(state);
  }
}

// å„çŠ¶æ…‹ã®å®Ÿè£…

class IdleState extends SessionState {
  get status(): SessionStatus {
    return 'idle';
  }

  async connect(): Promise<void> {
    this.transitionTo(new ConnectingState(this.context));
  }
}

class ConnectingState extends SessionState {
  get status(): SessionStatus {
    return 'connecting';
  }

  constructor(context: SessionContext) {
    super(context);
    this.performConnection();
  }

  private async performConnection(): Promise<void> {
    try {
      await this.context.videoService.connect(this.context.config);
      this.transitionTo(new ConnectedState(this.context));
    } catch (error) {
      this.context.onError(error as Error);
      this.transitionTo(new DisconnectedState(this.context));
    }
  }
}

class ConnectedState extends SessionState {
  get status(): SessionStatus {
    return 'connected';
  }

  async disconnect(): Promise<void> {
    try {
      await this.context.videoService.disconnect();
      this.transitionTo(new DisconnectedState(this.context));
    } catch (error) {
      this.context.onError(error as Error);
      this.transitionTo(new DisconnectedState(this.context));
    }
  }

  async toggleAudio(): Promise<boolean> {
    return this.context.videoService.toggleAudio();
  }

  async toggleVideo(): Promise<boolean> {
    return this.context.videoService.toggleVideo();
  }
}

class DisconnectedState extends SessionState {
  get status(): SessionStatus {
    return 'disconnected';
  }

  async connect(): Promise<void> {
    this.transitionTo(new ConnectingState(this.context));
  }
}

// çŠ¶æ…‹ãƒã‚·ãƒ³ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼

class SessionStateMachine {
  private currentState: SessionState;

  constructor(
    private videoService: IVideoService,
    private config: VideoConnectionConfig
  ) {
    const context: SessionContext = {
      videoService,
      config,
      onStateChange: (state) => { this.currentState = state; },
      onError: (error) => { console.error('Session error:', error); }
    };
    this.currentState = new IdleState(context);
  }

  get status(): SessionStatus {
    return this.currentState.status;
  }

  connect(): Promise<void> {
    return this.currentState.connect();
  }

  disconnect(): Promise<void> {
    return this.currentState.disconnect();
  }

  toggleAudio(): Promise<boolean> {
    return this.currentState.toggleAudio();
  }

  toggleVideo(): Promise<boolean> {
    return this.currentState.toggleVideo();
  }
}
```

**React Hooksã¨ã®çµ±åˆ:**

```typescript
// presentation/hooks/useSessionState.ts

export const useSessionState = (videoService: IVideoService, config: VideoConnectionConfig) => {
  const [status, setStatus] = useState<SessionStatus>('idle');
  const [error, setError] = useState<Error | null>(null);

  const stateMachineRef = useRef<SessionStateMachine>();

  useEffect(() => {
    const context: SessionContext = {
      videoService,
      config,
      onStateChange: (state) => setStatus(state.status),
      onError: setError
    };
    stateMachineRef.current = new SessionStateMachine(videoService, config);
  }, [videoService, config]);

  const connect = useCallback(() => {
    return stateMachineRef.current?.connect();
  }, []);

  const disconnect = useCallback(() => {
    return stateMachineRef.current?.disconnect();
  }, []);

  const toggleAudio = useCallback(() => {
    return stateMachineRef.current?.toggleAudio();
  }, []);

  const toggleVideo = useCallback(() => {
    return stateMachineRef.current?.toggleVideo();
  }, []);

  return {
    status,
    error,
    connect,
    disconnect,
    toggleAudio,
    toggleVideo,
    isConnected: status === 'connected',
    isConnecting: status === 'connecting'
  };
};
```

---

#### 1.4.5 ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨ã®å…¨ä½“åƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Presentation Layer                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ VideoCallPage                                            â”‚   â”‚
â”‚  â”‚   â””â”€â”€ useSessionState (State Pattern)                    â”‚   â”‚
â”‚  â”‚         â””â”€â”€ SessionStateMachine                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Application Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ VideoSessionSubject (Observer Pattern)                   â”‚   â”‚
â”‚  â”‚   â””â”€â”€ observers: [VideoGrid, VolumeManager, ...]         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Domain Layer                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ IVideoService (Adapter Pattern - Interface)              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Infrastructure Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ZoomVideoAdapter (Adapter Pattern - Implementation)      â”‚   â”‚
â”‚  â”‚   â””â”€â”€ ZoomVideoFacade (Facade Pattern)                   â”‚   â”‚
â”‚  â”‚         â””â”€â”€ ZoomVideo SDK                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | è²¬å‹™ | ä¸»ãªãƒ•ã‚¡ã‚¤ãƒ« |
|---------|------|-------------|
| Observer | ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥ã®ç–çµåˆåŒ– | `VideoSessionSubject.ts`, `*Observer.ts` |
| Facade | SDKè¤‡é›‘æ€§ã®éš è”½ | `ZoomVideoFacade.ts` |
| Adapter | SDKä¾å­˜ã®åˆ†é›¢ | `IVideoService.ts`, `ZoomVideoAdapter.ts` |
| State | çŠ¶æ…‹é·ç§»ã®æ˜ç¢ºåŒ– | `SessionState.ts`, `*State.ts` |

---

## 2. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

### 2.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (front/)

```
front/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ presentation/          # ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤
â”‚   â”‚   â”œâ”€â”€ components/        # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ common/        # å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Button/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Icon/
â”‚   â”‚   â”‚   â”œâ”€â”€ video/         # ãƒ“ãƒ‡ã‚ªé–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MainVideoDisplay/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SubVideoDisplay/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SelfVideoDisplay/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ VideoControls/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ VideoGrid/
â”‚   â”‚   â”‚   â””â”€â”€ layout/        # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚       â”œâ”€â”€ VerticalLayout/
â”‚   â”‚   â”‚       â””â”€â”€ FullScreenLayout/
â”‚   â”‚   â”œâ”€â”€ pages/             # ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ LoginPage/
â”‚   â”‚   â”‚   â””â”€â”€ VideoCallPage/
â”‚   â”‚   â””â”€â”€ hooks/             # ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”‚       â”œâ”€â”€ useKeyboardShortcut.ts
â”‚   â”‚       â”œâ”€â”€ useFullScreen.ts
â”‚   â”‚       â”œâ”€â”€ useSessionState.ts       # State Patternçµ±åˆ
â”‚   â”‚       â””â”€â”€ useOperatingHoursMonitor.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ application/           # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤
â”‚   â”‚   â”œâ”€â”€ usecases/          # ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ LoginUseCase.ts
â”‚   â”‚   â”‚   â””â”€â”€ video/
â”‚   â”‚   â”‚       â”œâ”€â”€ JoinSessionUseCase.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ SwitchMainSiteUseCase.ts
â”‚   â”‚   â”‚       â””â”€â”€ ControlMediaUseCase.ts
â”‚   â”‚   â”œâ”€â”€ services/          # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”‚   â””â”€â”€ OperatingHoursService.ts
â”‚   â”‚   â”œâ”€â”€ subjects/          # Observer Pattern - Subject
â”‚   â”‚   â”‚   â”œâ”€â”€ VideoSessionSubject.ts
â”‚   â”‚   â”‚   â””â”€â”€ OperatingHoursSubject.ts
â”‚   â”‚   â””â”€â”€ state/             # çŠ¶æ…‹ç®¡ç†
â”‚   â”‚       â”œâ”€â”€ context/
â”‚   â”‚       â”‚   â”œâ”€â”€ AuthContext.tsx
â”‚   â”‚       â”‚   â””â”€â”€ VideoContext.tsx
â”‚   â”‚       â””â”€â”€ reducers/
â”‚   â”‚           â”œâ”€â”€ authReducer.ts
â”‚   â”‚           â””â”€â”€ videoReducer.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ domain/                # ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤
â”‚   â”‚   â”œâ”€â”€ entities/          # ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚   â”‚   â”‚   â”œâ”€â”€ User.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ Company.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ Site.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ Participant.ts
â”‚   â”‚   â”‚   â””â”€â”€ VideoSession.ts
â”‚   â”‚   â”œâ”€â”€ valueObjects/      # å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ SiteId.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ CompanyId.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ VolumeLevel.ts
â”‚   â”‚   â”‚   â””â”€â”€ SessionStatus.ts
â”‚   â”‚   â”œâ”€â”€ services/          # ã‚µãƒ¼ãƒ“ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ (Adapter Pattern)
â”‚   â”‚   â”‚   â””â”€â”€ IVideoService.ts
â”‚   â”‚   â”œâ”€â”€ observers/         # Observer Pattern - ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ VideoSessionObserver.ts
â”‚   â”‚   â”‚   â””â”€â”€ OperatingHoursObserver.ts
â”‚   â”‚   â”œâ”€â”€ states/            # State Pattern - çŠ¶æ…‹ã‚¯ãƒ©ã‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ SessionState.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ IdleState.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ ConnectingState.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ ConnectedState.ts
â”‚   â”‚   â”‚   â””â”€â”€ DisconnectedState.ts
â”‚   â”‚   â””â”€â”€ repositories/      # ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚   â”‚       â”œâ”€â”€ IAuthRepository.ts
â”‚   â”‚       â””â”€â”€ ISiteRepository.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/        # ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤
â”‚   â”‚   â”œâ”€â”€ api/               # APIé€šä¿¡
â”‚   â”‚   â”‚   â”œâ”€â”€ apiClient.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ authApi.ts
â”‚   â”‚   â”‚   â””â”€â”€ siteApi.ts
â”‚   â”‚   â”œâ”€â”€ repositories/      # ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthRepository.ts
â”‚   â”‚   â”‚   â””â”€â”€ SiteRepository.ts
â”‚   â”‚   â”œâ”€â”€ adapters/          # Adapter Pattern - å®Ÿè£…
â”‚   â”‚   â”‚   â”œâ”€â”€ ZoomVideoAdapter.ts
â”‚   â”‚   â”‚   â””â”€â”€ MockVideoAdapter.ts   # ãƒ†ã‚¹ãƒˆç”¨
â”‚   â”‚   â””â”€â”€ zoom/              # Facade Pattern - Zoom SDKæ“ä½œ
â”‚   â”‚       â””â”€â”€ ZoomVideoFacade.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                # è¨­å®š
â”‚   â”‚   â””â”€â”€ constants.ts
â”‚   â”‚
â”‚   â””â”€â”€ types/                 # å‹å®šç¾©
â”‚       â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ tests/                     # ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ e2e/
â”‚
â”œâ”€â”€ public/
â”œâ”€â”€ index.html
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tsconfig.json
â””â”€â”€ package.json
```

### 2.2 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (server/)

```
server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ presentation/          # ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤
â”‚   â”‚   â”œâ”€â”€ routes/            # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
â”‚   â”‚   â”‚   â”œâ”€â”€ authRoutes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ siteRoutes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ sessionRoutes.ts
â”‚   â”‚   â”‚   â””â”€â”€ scheduleRoutes.ts
â”‚   â”‚   â”œâ”€â”€ controllers/       # ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthController.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ SiteController.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ SessionController.ts
â”‚   â”‚   â”‚   â””â”€â”€ ScheduleController.ts
â”‚   â”‚   â”œâ”€â”€ middleware/        # ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”‚   â”‚   â”‚   â”œâ”€â”€ authMiddleware.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ errorMiddleware.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ operatingHoursMiddleware.ts
â”‚   â”‚   â”‚   â””â”€â”€ validationMiddleware.ts
â”‚   â”‚   â””â”€â”€ validators/        # ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼
â”‚   â”‚       â”œâ”€â”€ authValidator.ts
â”‚   â”‚       â””â”€â”€ sessionValidator.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ application/           # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤
â”‚   â”‚   â”œâ”€â”€ usecases/          # ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LoginUseCase.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ GenerateJwtUseCase.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ site/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ GetSitesUseCase.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ session/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CreateSessionUseCase.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ JoinSessionUseCase.ts
â”‚   â”‚   â”‚   â””â”€â”€ schedule/
â”‚   â”‚   â”‚       â”œâ”€â”€ CheckOperatingHoursUseCase.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ GetScheduleUseCase.ts
â”‚   â”‚   â”‚       â””â”€â”€ UpdateScheduleUseCase.ts
â”‚   â”‚   â”œâ”€â”€ services/          # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”‚   â””â”€â”€ OperatingHoursService.ts
â”‚   â”‚   â””â”€â”€ dto/               # ãƒ‡ãƒ¼ã‚¿è»¢é€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
â”‚   â”‚       â”œâ”€â”€ AuthDto.ts
â”‚   â”‚       â”œâ”€â”€ SiteDto.ts
â”‚   â”‚       â”œâ”€â”€ SessionDto.ts
â”‚   â”‚       â””â”€â”€ ScheduleDto.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ domain/                # ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤
â”‚   â”‚   â”œâ”€â”€ entities/          # ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚   â”‚   â”‚   â”œâ”€â”€ User.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ Company.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ Site.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ Session.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ OperatingSchedule.ts
â”‚   â”‚   â”‚   â””â”€â”€ OperatingScheduleException.ts
â”‚   â”‚   â”œâ”€â”€ valueObjects/      # å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ UserId.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ CompanyId.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ SessionTopic.ts
â”‚   â”‚   â”‚   â””â”€â”€ TimeRange.ts
â”‚   â”‚   â”œâ”€â”€ repositories/      # ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ IUserRepository.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ ICompanyRepository.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ ISiteRepository.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ ISessionRepository.ts
â”‚   â”‚   â”‚   â””â”€â”€ IScheduleRepository.ts
â”‚   â”‚   â””â”€â”€ errors/            # ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼
â”‚   â”‚       â”œâ”€â”€ AuthError.ts
â”‚   â”‚       â”œâ”€â”€ SessionError.ts
â”‚   â”‚       â””â”€â”€ OperatingHoursError.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/        # ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤
â”‚   â”‚   â”œâ”€â”€ database/          # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
â”‚   â”‚   â”‚   â””â”€â”€ prisma/
â”‚   â”‚   â”‚       â”œâ”€â”€ client.ts
â”‚   â”‚   â”‚       â””â”€â”€ schema.prisma
â”‚   â”‚   â”œâ”€â”€ repositories/      # ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…
â”‚   â”‚   â”‚   â”œâ”€â”€ UserRepository.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ CompanyRepository.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ SiteRepository.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ SessionRepository.ts
â”‚   â”‚   â”‚   â””â”€â”€ ScheduleRepository.ts
â”‚   â”‚   â””â”€â”€ services/          # å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚       â”œâ”€â”€ ZoomJwtService.ts
â”‚   â”‚       â””â”€â”€ SessionKickService.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                # è¨­å®š
â”‚   â”‚   â”œâ”€â”€ env.ts
â”‚   â”‚   â””â”€â”€ constants.ts
â”‚   â”‚
â”‚   â””â”€â”€ app.ts                 # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ãƒˆãƒª
â”‚
â”œâ”€â”€ tests/                     # ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ unit/
â”‚   â””â”€â”€ integration/
â”‚
â”œâ”€â”€ tsconfig.json
â””â”€â”€ package.json
```

---

## 3. ç”»é¢è¨­è¨ˆ

### 3.1 ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆç¸¦ç”»é¢ãƒ»90åº¦å›è»¢ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                        â”‚  â†‘
â”‚                                        â”‚  â”‚
â”‚                                        â”‚  â”‚
â”‚          ãƒ¡ã‚¤ãƒ³è¡¨ç¤ºã‚¨ãƒªã‚¢               â”‚  â”‚
â”‚           (ä¸Šéƒ¨ 80%)                   â”‚  â”‚  ç”»é¢é«˜ã•
â”‚                                        â”‚  â”‚  (4K: 3840px)
â”‚         é¸æŠã•ã‚ŒãŸæ‹ ç‚¹ã®æ˜ åƒ            â”‚  â”‚
â”‚                                        â”‚  â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚                            â”‚ è‡ªåˆ†   â”‚  â”‚  â”‚  ã‚»ãƒ«ãƒ•ãƒ“ãƒ¥ãƒ¼
â”‚                            â”‚        â”‚  â”‚  â”‚  (å³ä¸‹ãƒ»å°)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”¤  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ æ‹ ç‚¹A  â”‚  â”‚ æ‹ ç‚¹B  â”‚  â”‚ æ‹ ç‚¹C  â”‚   â”‚  â”‚  ã‚µãƒ–è¡¨ç¤º
â”‚  â”‚        â”‚  â”‚        â”‚  â”‚        â”‚   â”‚  â”‚  (ä¸‹éƒ¨ 20%)
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â†“
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ¤]  [ğŸ“¹]                            â”‚  ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â† ç”»é¢å¹… (4K: 2160px) â†’
```

### 3.2 2æ‹ ç‚¹æ¥ç¶šæ™‚ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                        â”‚
â”‚                                        â”‚
â”‚                                        â”‚
â”‚                                        â”‚
â”‚          ç›¸æ‰‹æ‹ ç‚¹ã®æ˜ åƒ                 â”‚
â”‚           (100% ãƒ•ãƒ«è¡¨ç¤º)              â”‚
â”‚                                        â”‚
â”‚                                        â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                            â”‚ è‡ªåˆ†   â”‚  â”‚  ã‚»ãƒ«ãƒ•ãƒ“ãƒ¥ãƒ¼
â”‚                            â”‚        â”‚  â”‚  (å³ä¸‹ãƒ»å°)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”¤
â”‚  [ğŸ¤]  [ğŸ“¹]                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆéšå±¤

```
VideoCallPage
â”œâ”€â”€ VerticalLayout
â”‚   â”œâ”€â”€ MainVideoDisplay
â”‚   â”‚   â”œâ”€â”€ VideoCanvas (ãƒ¡ã‚¤ãƒ³æ‹ ç‚¹æ˜ åƒ)
â”‚   â”‚   â””â”€â”€ SelfVideoDisplay (å³ä¸‹ãƒ»å°ã‚µã‚¤ã‚º)
â”‚   â”‚       â””â”€â”€ VideoElement (è‡ªåˆ†ã®æ˜ åƒ)
â”‚   â”œâ”€â”€ SubVideoDisplay (3æ‹ ç‚¹ä»¥ä¸Šæ™‚ã®ã¿è¡¨ç¤º)
â”‚   â”‚   â””â”€â”€ VideoGrid
â”‚   â”‚       â””â”€â”€ VideoThumbnail[] (ã‚µãƒ–æ‹ ç‚¹æ˜ åƒ)
â”‚   â””â”€â”€ VideoControls
â”‚       â”œâ”€â”€ MicrophoneButton
â”‚       â””â”€â”€ CameraButton
â””â”€â”€ KeyboardShortcutHandler
```

### 3.4 ã‚»ãƒ«ãƒ•ãƒ“ãƒ¥ãƒ¼ä»•æ§˜

| é …ç›® | å€¤ |
|------|-----|
| ä½ç½® | ãƒ¡ã‚¤ãƒ³è¡¨ç¤ºã‚¨ãƒªã‚¢å³ä¸‹ |
| ã‚µã‚¤ã‚º | ç”»é¢å¹…ã®15%ç¨‹åº¦ |
| ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯” | 16:9 |
| è¡¨ç¤ºæ¡ä»¶ | ã‚«ãƒ¡ãƒ©ONæ™‚ã®ã¿è¡¨ç¤º |
| z-index | ãƒ¡ã‚¤ãƒ³æ˜ åƒã‚ˆã‚Šä¸Š |

---

## 4. çŠ¶æ…‹ç®¡ç†è¨­è¨ˆ

### 4.1 AuthContext

```typescript
interface AuthState {
  isAuthenticated: boolean;
  user: User | null;
  company: Company | null;
  token: string | null;
  loading: boolean;
  error: string | null;
}

type AuthAction =
  | { type: 'LOGIN_START' }
  | { type: 'LOGIN_SUCCESS'; payload: { user: User; company: Company; token: string } }
  | { type: 'LOGIN_FAILURE'; payload: string }
  | { type: 'LOGOUT' };
```

### 4.2 VideoContext

```typescript
interface VideoState {
  sessionStatus: 'idle' | 'connecting' | 'connected' | 'disconnected';
  participants: Participant[];
  mainSiteId: string | null;
  localMedia: {
    isMicOn: boolean;
    isCameraOn: boolean;
  };
  volumeSettings: Record<string, number>;  // siteId -> volume (0-100)
  error: string | null;
}

type VideoAction =
  | { type: 'CONNECT_START' }
  | { type: 'CONNECT_SUCCESS'; payload: Participant[] }
  | { type: 'CONNECT_FAILURE'; payload: string }
  | { type: 'PARTICIPANT_JOIN'; payload: Participant }
  | { type: 'PARTICIPANT_LEAVE'; payload: string }
  | { type: 'SWITCH_MAIN_SITE'; payload: string }
  | { type: 'TOGGLE_MIC' }
  | { type: 'TOGGLE_CAMERA' }
  | { type: 'DISCONNECT' };
```

---

## 5. APIè¨­è¨ˆ

### 5.1 èªè¨¼API

#### POST /api/auth/login
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³

**Request:**
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "uuid",
      "name": "å±±ç”°å¤ªéƒ",
      "email": "user@example.com",
      "siteId": "site-nagoya"
    },
    "company": {
      "id": "company-uuid",
      "name": "æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«"
    },
    "accessToken": "eyJhbGciOiJIUzI1NiIs..."
  }
}
```

### 5.2 ã‚»ãƒƒã‚·ãƒ§ãƒ³API

#### POST /api/sessions/join
ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«å‚åŠ ï¼ˆZoom JWTå–å¾—ï¼‰

**Request:**
```json
{
  "siteId": "site-nagoya"
}
```

**Response (æˆåŠŸæ™‚):**
```json
{
  "success": true,
  "data": {
    "zoomJwt": "eyJhbGciOiJIUzI1NiIs...",
    "sessionTopic": "company-uuid-session",
    "userName": "åå¤å±‹",
    "sites": [
      { "id": "site-tokyo", "name": "æ±äº¬", "isOnline": true },
      { "id": "site-osaka", "name": "å¤§é˜ª", "isOnline": true },
      { "id": "site-fukuoka", "name": "ç¦å²¡", "isOnline": false }
    ],
    "operatingHours": {
      "endTime": "18:00",
      "remainingMinutes": 120,
      "warningThresholdMinutes": 5
    }
  }
}
```

**Response (ç¨¼åƒæ™‚é–“å¤–ã‚¨ãƒ©ãƒ¼):**
```json
{
  "success": false,
  "error": {
    "code": "OUTSIDE_OPERATING_HOURS",
    "message": "ç¾åœ¨ã¯ç¨¼åƒæ™‚é–“å¤–ã§ã™",
    "details": {
      "currentTime": "19:30",
      "operatingHours": {
        "startTime": "09:00",
        "endTime": "18:00"
      },
      "nextOperatingDay": "2025-01-06",
      "nextStartTime": "09:00"
    }
  }
}
```

### 5.3 æ‹ ç‚¹API

#### GET /api/sites
ä¼šç¤¾ã®æ‹ ç‚¹ä¸€è¦§å–å¾—

**Response:**
```json
{
  "success": true,
  "data": {
    "sites": [
      { "id": "site-tokyo", "name": "æ±äº¬", "displayOrder": 1 },
      { "id": "site-nagoya", "name": "åå¤å±‹", "displayOrder": 2 },
      { "id": "site-osaka", "name": "å¤§é˜ª", "displayOrder": 3 },
      { "id": "site-fukuoka", "name": "ç¦å²¡", "displayOrder": 4 }
    ]
  }
}
```

### 5.4 ç¨¼åƒæ™‚é–“ç®¡ç†API

#### GET /api/schedules
ç¨¼åƒã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€è¦§å–å¾—

**Response:**
```json
{
  "success": true,
  "data": {
    "schedules": [
      { "dayOfWeek": 0, "startTime": null, "endTime": null, "isEnabled": false },
      { "dayOfWeek": 1, "startTime": "09:00", "endTime": "18:00", "isEnabled": true },
      { "dayOfWeek": 2, "startTime": "09:00", "endTime": "18:00", "isEnabled": true },
      { "dayOfWeek": 3, "startTime": "09:00", "endTime": "18:00", "isEnabled": true },
      { "dayOfWeek": 4, "startTime": "09:00", "endTime": "18:00", "isEnabled": true },
      { "dayOfWeek": 5, "startTime": "09:00", "endTime": "18:00", "isEnabled": true },
      { "dayOfWeek": 6, "startTime": null, "endTime": null, "isEnabled": false }
    ],
    "exceptions": [
      { "date": "2025-01-01", "type": "holiday", "description": "å…ƒæ—¥" },
      { "date": "2025-03-15", "type": "custom", "startTime": "10:00", "endTime": "15:00", "description": "è‡¨æ™‚ç¨¼åƒ" }
    ],
    "timezone": "Asia/Tokyo"
  }
}
```

#### PUT /api/schedules
ç¨¼åƒã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ›´æ–°ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰

**Request:**
```json
{
  "schedules": [
    { "dayOfWeek": 1, "startTime": "08:30", "endTime": "17:30", "isEnabled": true }
  ]
}
```

#### POST /api/schedules/exceptions
ä¾‹å¤–æ—¥ã®è¿½åŠ ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰

**Request:**
```json
{
  "date": "2025-12-29",
  "type": "closed",
  "description": "å¹´æœ«ä¼‘æ¥­"
}
```

#### GET /api/schedules/status
ç¾åœ¨ã®ç¨¼åƒçŠ¶æ…‹ã‚’å–å¾—

**Response:**
```json
{
  "success": true,
  "data": {
    "isOperating": true,
    "currentTime": "14:30",
    "todaySchedule": {
      "startTime": "09:00",
      "endTime": "18:00"
    },
    "remainingMinutes": 210,
    "warningThresholdMinutes": 5
  }
}
```

---

## 6. ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆè¨­è¨ˆ

| ã‚­ãƒ¼ | æ©Ÿèƒ½ |
|------|------|
| `1` | 1ç•ªç›®ã®æ‹ ç‚¹ã‚’ãƒ¡ã‚¤ãƒ³ã«è¡¨ç¤º |
| `2` | 2ç•ªç›®ã®æ‹ ç‚¹ã‚’ãƒ¡ã‚¤ãƒ³ã«è¡¨ç¤º |
| `3` | 3ç•ªç›®ã®æ‹ ç‚¹ã‚’ãƒ¡ã‚¤ãƒ³ã«è¡¨ç¤º |
| `4` | 4ç•ªç›®ã®æ‹ ç‚¹ã‚’ãƒ¡ã‚¤ãƒ³ã«è¡¨ç¤º |
| `M` | ãƒã‚¤ã‚¯ã®ãƒŸãƒ¥ãƒ¼ãƒˆåˆ‡ã‚Šæ›¿ãˆ |
| `V` | ã‚«ãƒ¡ãƒ©ã®ã‚ªãƒ³/ã‚ªãƒ•åˆ‡ã‚Šæ›¿ãˆ |
| `â†` / `â†’` | ãƒ¡ã‚¤ãƒ³è¡¨ç¤ºã®å‰å¾Œåˆ‡ã‚Šæ›¿ãˆ |

---

## 7. éŸ³é‡åˆ¶å¾¡è¨­è¨ˆ

### 7.1 éŸ³é‡ãƒ¬ãƒ™ãƒ«å®šæ•°

```typescript
// config/constants.ts
export const VOLUME_LEVELS = {
  MAIN: 100,      // ãƒ¡ã‚¤ãƒ³æ‹ ç‚¹: æœ€å¤§éŸ³é‡
  SUB: 30,        // ã‚µãƒ–æ‹ ç‚¹: 30%éŸ³é‡
  MUTED: 0        // ãƒŸãƒ¥ãƒ¼ãƒˆ
} as const;
```

### 7.2 éŸ³é‡åˆ‡ã‚Šæ›¿ãˆãƒ­ã‚¸ãƒƒã‚¯

```typescript
// ãƒ¡ã‚¤ãƒ³æ‹ ç‚¹åˆ‡ã‚Šæ›¿ãˆæ™‚ã®éŸ³é‡èª¿æ•´
const switchMainSite = (newMainSiteId: string) => {
  // å‰ã®ãƒ¡ã‚¤ãƒ³æ‹ ç‚¹ã‚’ä½éŸ³é‡ã«
  if (currentMainSiteId) {
    zoomMediaStream.adjustUserVolume(currentMainSiteId, VOLUME_LEVELS.SUB);
  }

  // æ–°ã—ã„ãƒ¡ã‚¤ãƒ³æ‹ ç‚¹ã‚’é«˜éŸ³é‡ã«
  zoomMediaStream.adjustUserVolume(newMainSiteId, VOLUME_LEVELS.MAIN);

  setMainSiteId(newMainSiteId);
};
```

---

## 8. ç¨¼åƒæ™‚é–“ç®¡ç†è¨­è¨ˆ

### 8.1 ç¨¼åƒæ™‚é–“ãƒã‚§ãƒƒã‚¯ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ã‚»ãƒƒã‚·ãƒ§ãƒ³å‚åŠ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              operatingHoursMiddleware.ts                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. ä¼šç¤¾IDã‹ã‚‰ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å–å¾—                             â”‚   â”‚
â”‚  â”‚ 2. ç¾åœ¨æ—¥æ™‚ã‚’ä¼šç¤¾ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã§å–å¾—                        â”‚   â”‚
â”‚  â”‚ 3. ä¾‹å¤–æ—¥ï¼ˆç¥æ—¥ãƒ»è‡¨æ™‚ä¼‘æ¥­ï¼‰ãƒã‚§ãƒƒã‚¯                        â”‚   â”‚
â”‚  â”‚ 4. é€šå¸¸ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯                               â”‚   â”‚
â”‚  â”‚ 5. ç¨¼åƒæ™‚é–“å†… â†’ next() / æ™‚é–“å¤– â†’ ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼                                     â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   ç¨¼åƒæ™‚é–“å†…   â”‚                    â”‚  ç¨¼åƒæ™‚é–“å¤–   â”‚
   â”‚  ã‚»ãƒƒã‚·ãƒ§ãƒ³å‚åŠ â”‚                    â”‚  ã‚¨ãƒ©ãƒ¼è¿”å´   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 ç¨¼åƒæ™‚é–“åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯

```typescript
// application/services/OperatingHoursService.ts

interface OperatingStatus {
  isOperating: boolean;
  currentTime: string;
  todaySchedule: { startTime: string; endTime: string } | null;
  remainingMinutes: number | null;
  reason?: 'holiday' | 'closed' | 'outside_hours' | 'day_off';
}

class OperatingHoursService {
  async checkOperatingStatus(companyId: string): Promise<OperatingStatus> {
    const company = await this.companyRepository.findById(companyId);
    const now = this.getCurrentTimeInTimezone(company.timezone);
    const today = now.toISODate();
    const dayOfWeek = now.weekday % 7; // 0-6 (æ—¥æ›œ=0)

    // 1. ä¾‹å¤–æ—¥ãƒã‚§ãƒƒã‚¯ï¼ˆç¥æ—¥ãƒ»è‡¨æ™‚ä¼‘æ¥­ãƒ»è‡¨æ™‚ç¨¼åƒï¼‰
    const exception = await this.scheduleRepository.findException(companyId, today);
    if (exception) {
      return this.handleException(exception, now);
    }

    // 2. é€šå¸¸ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯
    const schedule = await this.scheduleRepository.findByDayOfWeek(companyId, dayOfWeek);
    if (!schedule?.isEnabled) {
      return { isOperating: false, reason: 'day_off', ... };
    }

    // 3. æ™‚é–“ç¯„å›²ãƒã‚§ãƒƒã‚¯
    return this.checkTimeRange(schedule, now);
  }
}
```

### 8.3 è‡ªå‹•é€€å‡ºï¼ˆã‚­ãƒƒã‚¯ï¼‰æ©Ÿèƒ½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              OperatingHoursMonitor                       â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ æ®‹ã‚Šæ™‚é–“ã‚«ã‚¦ãƒ³ãƒˆ   â”‚ â”€â”€â–¶ â”‚ 5åˆ†å‰: è­¦å‘Šé€šçŸ¥è¡¨ç¤º       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ (1åˆ†é–“éš”ã§APIç¢ºèª) â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚   â”‚
â”‚  â”‚           â”‚                                              â”‚   â”‚
â”‚  â”‚           â–¼                                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ æ®‹ã‚Š0åˆ†åˆ°é”       â”‚ â”€â”€â–¶ â”‚ è‡ªå‹•é€€å‡ºå‡¦ç†å®Ÿè¡Œ          â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ ãƒ»Zoomã‚»ãƒƒã‚·ãƒ§ãƒ³é›¢è„±      â”‚ â”‚   â”‚
â”‚  â”‚                            â”‚ ãƒ»çµ‚äº†ç”»é¢ã¸é·ç§»          â”‚ â”‚   â”‚
â”‚  â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.4 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

```typescript
// presentation/hooks/useOperatingHoursMonitor.ts

const POLLING_INTERVAL_MS = 60000;  // 1åˆ†é–“éš”
const WARNING_THRESHOLD_MINUTES = 5;

export const useOperatingHoursMonitor = () => {
  const [remainingMinutes, setRemainingMinutes] = useState<number | null>(null);
  const [showWarning, setShowWarning] = useState(false);
  const { disconnect } = useVideoContext();

  useEffect(() => {
    const checkStatus = async () => {
      const status = await operatingHoursApi.getStatus();

      if (!status.isOperating) {
        // ç¨¼åƒæ™‚é–“å¤–ã«ãªã£ãŸ â†’ å¼·åˆ¶é€€å‡º
        await disconnect();
        navigate('/session-ended', { reason: 'operating_hours_ended' });
        return;
      }

      setRemainingMinutes(status.remainingMinutes);

      // è­¦å‘Šè¡¨ç¤º
      if (status.remainingMinutes <= WARNING_THRESHOLD_MINUTES) {
        setShowWarning(true);
      }
    };

    const interval = setInterval(checkStatus, POLLING_INTERVAL_MS);
    checkStatus(); // åˆå›å³æ™‚å®Ÿè¡Œ

    return () => clearInterval(interval);
  }, []);

  return { remainingMinutes, showWarning };
};
```

### 8.5 è­¦å‘Šé€šçŸ¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```typescript
// presentation/components/OperatingHoursWarning.tsx

const OperatingHoursWarning: React.FC<{ remainingMinutes: number }> = ({
  remainingMinutes
}) => {
  if (remainingMinutes > WARNING_THRESHOLD_MINUTES) {
    return null;
  }

  return (
    <div className="operating-hours-warning">
      <span>ç¨¼åƒçµ‚äº†ã¾ã§æ®‹ã‚Š {remainingMinutes} åˆ†ã§ã™</span>
      <span>çµ‚äº†æ™‚åˆ»ã«ãªã‚‹ã¨è‡ªå‹•çš„ã«é€šè©±ãŒçµ‚äº†ã—ã¾ã™</span>
    </div>
  );
};
```

### 8.6 å®šæ•°å®šç¾©

```typescript
// config/constants.ts

export const OPERATING_HOURS = {
  POLLING_INTERVAL_MS: 60000,         // çŠ¶æ…‹ç¢ºèªé–“éš”ï¼ˆ1åˆ†ï¼‰
  WARNING_THRESHOLD_MINUTES: 5,        // è­¦å‘Šè¡¨ç¤ºã®é–¾å€¤ï¼ˆçµ‚äº†5åˆ†å‰ï¼‰
  GRACE_PERIOD_SECONDS: 30,           // çµ‚äº†å¾Œã®çŒ¶äºˆæ™‚é–“ï¼ˆ30ç§’ï¼‰
} as const;

export const DAY_OF_WEEK = {
  SUNDAY: 0,
  MONDAY: 1,
  TUESDAY: 2,
  WEDNESDAY: 3,
  THURSDAY: 4,
  FRIDAY: 5,
  SATURDAY: 6,
} as const;
```

---

## 9. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### 9.1 ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢

```
ã‚»ãƒƒã‚·ãƒ§ãƒ³topicå‘½åè¦å‰‡: {companyId}-video-session

ä¾‹:
- ä¼šç¤¾A: company-a-uuid-video-session
- ä¼šç¤¾B: company-b-uuid-video-session

â†’ ç•°ãªã‚‹ä¼šç¤¾ã¯ç•°ãªã‚‹topicã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€ç›¸äº’ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯
```

### 9.2 JWTèªè¨¼ãƒ•ãƒ­ãƒ¼

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼: ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±é€ä¿¡
   â†“
2. ã‚µãƒ¼ãƒãƒ¼: ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ â†’ ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œ
   â†“
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã‚»ãƒƒã‚·ãƒ§ãƒ³å‚åŠ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ä»˜ã)
   â†“
4. ã‚µãƒ¼ãƒãƒ¼: ä¼šç¤¾IDæ¤œè¨¼ â†’ Zoom SDK JWTç”Ÿæˆ
   â†“
5. ãƒ¦ãƒ¼ã‚¶ãƒ¼: Zoom SDK JWT ã§ãƒ“ãƒ‡ã‚ªã‚»ãƒƒã‚·ãƒ§ãƒ³æ¥ç¶š
```

### 9.3 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

| å¯¾ç­– | å®Ÿè£… |
|------|------|
| HTTPSå¼·åˆ¶ | Helmet middleware |
| CORSåˆ¶é™ | è¨±å¯ã‚ªãƒªã‚¸ãƒ³ã®ã¿ |
| JWTæœ‰åŠ¹æœŸé™ | 2æ™‚é–“ï¼ˆZoom SDK JWTï¼‰ |
| ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | express-rate-limit |
| å…¥åŠ›æ¤œè¨¼ | Zod / class-validator |

---

## 10. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¨­è¨ˆ

### 10.1 ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ã‚¯ãƒ©ã‚¹

```typescript
// domain/errors/AppError.ts
abstract class AppError extends Error {
  abstract readonly statusCode: number;
  abstract readonly isOperational: boolean;
}

class AuthenticationError extends AppError {
  readonly statusCode = 401;
  readonly isOperational = true;
}

class AuthorizationError extends AppError {
  readonly statusCode = 403;
  readonly isOperational = true;
}

class NotFoundError extends AppError {
  readonly statusCode = 404;
  readonly isOperational = true;
}

class VideoConnectionError extends AppError {
  readonly statusCode = 500;
  readonly isOperational = true;
}
```

### 10.2 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```typescript
// Zoom SDKæ¥ç¶šã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥
const MAX_RETRY_COUNT = 3;
const RETRY_DELAY_MS = 2000;

const connectWithRetry = async (retryCount = 0): Promise<void> => {
  try {
    await zoomClient.join(topic, token, userName);
  } catch (error) {
    if (retryCount < MAX_RETRY_COUNT) {
      await delay(RETRY_DELAY_MS);
      return connectWithRetry(retryCount + 1);
    }
    throw new VideoConnectionError('æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸ');
  }
};
```

---

## 11. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### 11.1 ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰

```
        /\
       /  \       E2E ãƒ†ã‚¹ãƒˆ (å°‘æ•°)
      /    \      - ä¸»è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼
     /â”€â”€â”€â”€â”€â”€\
    /        \    çµ±åˆãƒ†ã‚¹ãƒˆ (ä¸­ç¨‹åº¦)
   /          \   - API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
  /â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\  - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé€£æº
 /              \
/                \ ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ (å¤šæ•°)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  - ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
                    - ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
                    - ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
```

### 11.2 TDDã‚µã‚¤ã‚¯ãƒ«

```
1. Red: å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
   â†“
2. Green: ãƒ†ã‚¹ãƒˆãŒé€šã‚‹æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
   â†“
3. Refactor: ã‚³ãƒ¼ãƒ‰ã‚’æ”¹å–„ï¼ˆãƒ†ã‚¹ãƒˆã¯é€šã£ãŸã¾ã¾ï¼‰
   â†“
1. ã«æˆ»ã‚‹
```

### 11.3 ãƒ†ã‚¹ãƒˆå¯¾è±¡

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | ãƒ†ã‚¹ãƒˆå¯¾è±¡ | ãƒ„ãƒ¼ãƒ« |
|---------|-----------|--------|
| Domain | ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã€å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ | Vitest |
| Application | ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ | Vitest + Mock |
| Presentation | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | Testing Library |
| Infrastructure | ãƒªãƒã‚¸ãƒˆãƒª | Vitest + Prisma Mock |
| E2E | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼ | Playwright |

---

## 12. ä»Šå¾Œã®æ‹¡å¼µæ€§

### 12.1 æ©Ÿèƒ½æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ

| æ©Ÿèƒ½ | æ‹¡å¼µæ–¹æ³• |
|------|---------|
| 4Kå¯¾å¿œ | VideoQuality.Video_4K ä½¿ç”¨ |
| æ‹ ç‚¹è¿½åŠ  | DBç™»éŒ²ã®ã¿ã§å¯¾å¿œå¯èƒ½ |
| éŒ²ç”»æ©Ÿèƒ½ | Zoom SDK RecordingClient ä½¿ç”¨ |
| ç”»é¢å…±æœ‰ | Zoom SDK Shareæ©Ÿèƒ½ ä½¿ç”¨ |
| ãƒãƒ£ãƒƒãƒˆ | Zoom SDK ChatClient ä½¿ç”¨ |

### 12.2 ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°

- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: CDNé…ä¿¡
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°å¯¾å¿œï¼ˆã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹è¨­è¨ˆï¼‰
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: Supabaseã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°æ©Ÿèƒ½æ´»ç”¨
