# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

Zoom Video SDK (v2.3.5) を使用した拠点間ビデオ通話Webアプリケーション。4K縦向きディスプレイ（90度回転）でのフルスクリーン運用を想定。マルチテナント対応。

## コマンド

### フロントエンド (`front/`)
```bash
cd front && npm run dev       # 開発サーバー起動
cd front && npm run build     # プロダクションビルド（tsc + vite build）
cd front && npm run lint      # ESLint実行
cd front && npm run test      # Vitestでテスト実行
cd front && npm run test:ui   # Vitest UI
```

### バックエンド (`server/`)
```bash
cd server && npm run dev      # 開発サーバー起動（tsx watch）
cd server && npm run build    # TypeScriptコンパイル
cd server && npm run start    # プロダクション起動
cd server && npm run lint     # ESLint実行
cd server && npm run test     # Vitestでテスト実行
```

### 単一テスト実行
```bash
cd front && npx vitest run src/features/auth/components/LoginForm.test.tsx
cd server && npx vitest run src/features/auth/usecases/LoginUseCase.test.ts
```

### データベース（Prisma）
```bash
cd server && npm run db:generate  # Prisma Client生成
cd server && npm run db:migrate   # マイグレーション実行
cd server && npm run db:push      # スキーマ反映
cd server && npm run db:studio    # Prisma Studio起動
cd server && npm run db:seed      # シードデータ投入
```

## アーキテクチャ

### レイヤー構造（Clean Architecture + Feature-Based）
```
front/src/
├── app/              # アプリ設定、プロバイダー
├── pages/            # ページコンポーネント
├── features/         # 機能モジュール（auth, video-call, operating-hours, sites）
├── entities/         # ドメインエンティティ型定義
└── shared/           # 共通コンポーネント、hooks、lib

server/src/
├── app/              # Express設定、サーバー起動
├── features/         # 機能モジュール（auth, session, operating-hours, sites）
│   └── [feature]/
│       ├── usecases/     # ビジネスロジック
│       ├── dto/          # データ転送オブジェクト
│       ├── validators/   # Zodバリデーション
│       └── routes/       # Expressルート
├── entities/         # ドメインエンティティ
├── infrastructure/   # リポジトリ、外部サービス
├── shared/           # 共通エラー、ミドルウェア
└── config/           # 環境設定
```

### 技術スタック
- **フロントエンド**: React 18 + TypeScript + Vite + React Router 6
- **バックエンド**: Node.js + Express + TypeScript
- **ORM**: Prisma
- **DB**: Supabase (PostgreSQL)
- **テスト**: Vitest + Testing Library
- **バリデーション**: Zod

### 主要データモデル
- `Company` → `Site` → `User`: マルチテナント構造
- `Session` → `SessionParticipant`: ビデオ通話セッション
- `OperatingSchedule`, `OperatingScheduleException`: 稼働時間管理
- `SiteDevice`: 拠点デバイス認証

### デザインパターン
- **Observer Pattern**: 参加者状態・稼働時間監視（`front/src/features/video-call/observers/`）
- **Facade Pattern**: Zoom SDK操作（`front/src/features/video-call/facade/`）
- **Adapter Pattern**: ビデオサービス抽象化（`front/src/features/video-call/services/`）
- **State Pattern**: セッション状態管理（`front/src/features/video-call/states/`）

## コーディング規約

- **アーリーリターン**を積極活用、ネストを深くしない
- **マジックナンバー禁止**: 定数として定義
- **any型の使用禁止**: 適切な型定義を必須化
- **関数は20行以内**を目安、引数は3つ以内推奨
- **単一責任の原則**を徹底
- 不要な再レンダリング防止（React.memo、useMemo活用）
- テストファイルは実装ファイルと同階層に配置（`*.test.ts`）
