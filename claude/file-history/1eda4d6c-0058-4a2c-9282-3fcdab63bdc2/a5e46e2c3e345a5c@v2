import type { Participant } from '@/entities';
import type { SiteOnlineStatus } from '../../types';
import { VideoThumbnail } from './VideoThumbnail';
import './VideoGrid.scss';

/**
 * ビデオレンダリング関数の型
 */
interface VideoRenderer {
  attachVideo: (
    participantId: string,
    container: HTMLElement
  ) => Promise<void>;
  detachVideo: (participantId: string, container: HTMLElement) => Promise<void>;
}

/**
 * VideoGrid Props
 */
interface VideoGridProps {
  participants: Participant[];
  sites: SiteOnlineStatus[];
  mainSiteId: string | null;
  onSiteSelect: (siteId: string) => void;
  videoRenderer?: VideoRenderer;
}

/**
 * VideoGrid
 * サブ拠点のグリッドレイアウトコンポーネント
 */
export const VideoGrid = ({
  participants,
  sites,
  mainSiteId,
  onSiteSelect,
  videoRenderer,
}: VideoGridProps) => {
  // メイン拠点以外の参加者をフィルタリング
  const subParticipants = participants.filter(p => p.siteId !== mainSiteId);

  // 拠点IDから拠点名を取得
  const getSiteName = (siteId: string): string => {
    const site = sites.find(s => s.id === siteId);
    return site?.name || 'Unknown';
  };

  if (subParticipants.length === 0) {
    return (
      <div className="video-grid video-grid--empty">
        <span className="video-grid__empty-message">
          他の拠点の参加を待っています...
        </span>
      </div>
    );
  }

  return (
    <div className="video-grid">
      {subParticipants.map(participant => (
        <VideoThumbnail
          key={participant.id}
          participant={participant}
          siteName={getSiteName(participant.siteId)}
          isSelected={participant.siteId === mainSiteId}
          onClick={() => onSiteSelect(participant.siteId)}
          videoRenderer={videoRenderer}
        />
      ))}
    </div>
  );
};
