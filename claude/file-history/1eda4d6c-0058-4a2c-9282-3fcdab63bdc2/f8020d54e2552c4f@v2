import type { Participant } from '@/entities';
import type { VideoConnectionConfig, VolumeLevel } from '../types';
import type { VideoSessionObserver } from '../observers';

/**
 * ビデオアタッチオプション
 */
export interface VideoAttachOptions {
  participantId: string;
  container: HTMLElement;
}

/**
 * ビデオサービスインターフェース
 * Zoom SDKへの依存をアプリケーション層から分離するためのAdapter Pattern
 */
export interface IVideoService {
  /**
   * ビデオセッションに接続
   * @param config 接続設定
   */
  connect(config: VideoConnectionConfig): Promise<void>;

  /**
   * ビデオセッションから切断
   */
  disconnect(): Promise<void>;

  /**
   * オーディオのオン/オフを切り替え
   * @returns 切り替え後のオーディオ状態（true: オン, false: オフ）
   */
  toggleAudio(): Promise<boolean>;

  /**
   * ビデオのオン/オフを切り替え
   * @returns 切り替え後のビデオ状態（true: オン, false: オフ）
   */
  toggleVideo(): Promise<boolean>;

  /**
   * 参加者の音量を設定
   * @param participantId 参加者ID
   * @param level 音量レベル
   */
  setVolume(participantId: string, level: VolumeLevel): Promise<void>;

  /**
   * 現在の参加者一覧を取得
   */
  getParticipants(): Participant[];

  /**
   * イベントオブザーバーを登録
   * @param observer オブザーバー
   * @returns 登録解除関数
   */
  subscribeToEvents(observer: VideoSessionObserver): () => void;

  /**
   * 接続状態を取得
   */
  isConnected(): boolean;

  /**
   * オーディオ状態を取得
   */
  isAudioOn(): boolean;

  /**
   * ビデオ状態を取得
   */
  isVideoOn(): boolean;

  /**
   * 参加者のビデオをコンテナにアタッチ
   * @param options アタッチオプション
   */
  attachVideo(options: VideoAttachOptions): Promise<void>;

  /**
   * 参加者のビデオをデタッチ
   * @param participantId 参加者ID
   * @param container コンテナ要素
   */
  detachVideo(participantId: string, container: HTMLElement): Promise<void>;

  /**
   * 自分のビデオをコンテナにアタッチ
   * @param container コンテナ要素
   */
  attachSelfVideo(container: HTMLElement): Promise<void>;

  /**
   * 自分のビデオをデタッチ
   * @param container コンテナ要素
   */
  detachSelfVideo(container: HTMLElement): Promise<void>;
}
