import { apiClient } from '@/shared/lib/apiClient';
import type { LoginCredentials, LoginResponse, SiteAuthResponse } from '../types';
import type { User, Company } from '@/entities';

interface GetCurrentUserResponse {
  user: User;
  company: Company;
}

export const authApi = {
  login: async (credentials: LoginCredentials): Promise<LoginResponse> => {
    const response = await apiClient.post<LoginResponse>('/auth/login', credentials);

    if (!response.success || !response.data) {
      throw new Error(response.error?.message || 'ログインに失敗しました');
    }

    return response.data;
  },

  getCurrentUser: async (): Promise<GetCurrentUserResponse> => {
    const response = await apiClient.get<GetCurrentUserResponse>('/auth/me');

    if (!response.success || !response.data) {
      throw new Error(response.error?.message || 'ユーザー情報の取得に失敗しました');
    }

    return response.data;
  },

  authenticateBySiteToken: async (siteToken: string): Promise<SiteAuthResponse> => {
    const response = await apiClient.post<SiteAuthResponse>('/auth/site', { siteToken });

    if (!response.success || !response.data) {
      throw new Error(response.error?.message || '拠点認証に失敗しました');
    }

    return response.data;
  },
};
