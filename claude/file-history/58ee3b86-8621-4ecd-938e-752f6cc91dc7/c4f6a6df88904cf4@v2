import jwt from 'jsonwebtoken';
import { env } from '@/config/index.js';

interface AppJwtPayload {
  sub: string;
  companyId: string;
  siteId: string;
  role: 'admin' | 'user';
  iat?: number;
  exp?: number;
}

export const generateAppToken = (user: {
  id: string;
  companyId: string;
  siteId: string;
  role: 'admin' | 'user';
}): string => {
  return jwt.sign(
    {
      sub: user.id,
      companyId: user.companyId,
      siteId: user.siteId,
      role: user.role,
    },
    env.JWT_SECRET,
    { expiresIn: env.JWT_EXPIRES_IN }
  );
};

export const verifyAppToken = (token: string): AppJwtPayload => {
  return jwt.verify(token, env.JWT_SECRET) as AppJwtPayload;
};

export const decodeToken = (token: string): AppJwtPayload | null => {
  return jwt.decode(token) as AppJwtPayload | null;
};
